"use strict";(self.webpackChunkserver_provitask=self.webpackChunkserver_provitask||[]).push([[5199],{54920:(W,c,e)=>{e.d(c,{R:()=>r});var t=e(61166),d=e(40464);function r(l={},E={}){const{id:a="",...s}=l,{get:g}=(0,t.useFetchClient)(),{data:n,isError:m,isLoading:P,refetch:C}=(0,d.useQuery)(["users",a,s],async()=>{const{data:{data:f}}=await g(`/admin/users/${a}`,{params:s});return f},E);let p=[];return a&&n?p=[n]:Array.isArray(n?.results)&&(p=n.results),{users:p,pagination:n?.pagination??null,isLoading:P,isError:m,refetch:C}}},71359:(W,c,e)=>{e.d(c,{Z:()=>m});var t=e(27279),d=e(52185),r=e(51413),l=e(61166),E=e(22905),a=e(70627),s=e.n(a),g=e(26781);const n=({displayedFilters:P})=>{const[C,p]=(0,t.useState)(!1),{formatMessage:f}=(0,g.Z)(),A=(0,t.useRef)(),O=()=>{p(T=>!T)};return t.createElement(t.Fragment,null,t.createElement(d.x,{paddingTop:1,paddingBottom:1},t.createElement(r.z,{variant:"tertiary",ref:A,startIcon:t.createElement(E.Z,null),onClick:O,size:"S"},f({id:"app.utils.filters",defaultMessage:"Filters"})),C&&t.createElement(l.FilterPopoverURLQuery,{displayedFilters:P,isVisible:C,onToggle:O,source:A})),t.createElement(l.FilterListURLQuery,{filtersSchema:P}))};n.propTypes={displayedFilters:s().arrayOf(s().shape({name:s().string.isRequired,metadatas:s().shape({label:s().string}),fieldSchema:s().shape({type:s().string})})).isRequired};const m=n},61611:(W,c,e)=>{e.d(c,{W:()=>pe,Z:()=>Fe});var t=e(27279),d=e(796),r=e(34041),l=e(51452),E=e(49969),a=e(61166),s=e(29206),g=e.n(s),n=e(26781),m=e(40464),P=e(49402),C=e(51447),p=e(54920),f=e(80902),A=e(36364),O=e(71359),T=e(51413),F=e(88898),se=e(70627),u=e.n(se);const _=({onClick:o})=>{const{formatMessage:y}=(0,n.Z)();return t.createElement(T.z,{onClick:o,startIcon:t.createElement(F.Z,null),size:"S"},y({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}))};_.propTypes={onClick:u().func.isRequired};var ne=e(84428),b=e(66016),G=e(9465),le=e(83667),Z=e(35557),z=e(85898),ee=e(2667),M=e(52185),fe=e(9663),Me=e(18076),re=e(96854);const oe=({canDelete:o,headers:y,entriesToDelete:R,onClickDelete:k,onSelectRow:$,withMainAction:j,withBulkActions:x,rows:B})=>{const{push:D,location:{pathname:Q}}=(0,C.k6)(),{formatMessage:L}=(0,n.Z)();return t.createElement(ne.p,null,B.map(i=>{const N=R.findIndex(I=>I===i.id)!==-1;return t.createElement(b.Tr,{key:i.id,...(0,a.onRowClick)({fn:()=>D(`${Q}/${i.id}`),condition:x})},j&&t.createElement(G.Td,{...a.stopPropagation},t.createElement(le.C,{"aria-label":L({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,re.Pp)(i.firstname,i.lastname)}),checked:N,onChange:()=>{$({name:i.id,value:!N})}})),y.map(({key:I,cellFormatter:H,name:K,...V})=>t.createElement(G.Td,{key:I},typeof H=="function"?H(i,{key:I,name:K,formatMessage:L,...V}):t.createElement(Z.Z,{textColor:"neutral800"},i[K]||"-"))),x&&t.createElement(G.Td,null,t.createElement(z.k,{justifyContent:"end"},t.createElement(ee.h,{onClick:()=>D(`${Q}/${i.id}`),label:L({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,re.Pp)(i.firstname,i.lastname)}),noBorder:!0,icon:t.createElement(fe.Z,null)}),o&&t.createElement(M.x,{paddingLeft:1,...a.stopPropagation},t.createElement(ee.h,{onClick:()=>k(i.id),label:L({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,re.Pp)(i.firstname,i.lastname)}),noBorder:!0,icon:t.createElement(Me.Z,null)})))))}))};oe.defaultProps={canDelete:!1,entriesToDelete:[],onClickDelete(){},onSelectRow(){},rows:[],withBulkActions:!1,withMainAction:!1},oe.propTypes={canDelete:u().bool,entriesToDelete:u().array,headers:u().array.isRequired,onClickDelete:u().func,onSelectRow:u().func,rows:u().array,withBulkActions:u().bool,withMainAction:u().bool};const ye=oe;var he=e(81565),ve=e(37386),Pe=e(23851),me=e(90529),ie=e(49899),Ce=e(3785),Ae=e(89486),De=e(82298),Te=e(71563),Le=e(30164),Oe=e(85243),J=e(47853);const ue={firstname:"",lastname:"",email:"",roles:[]},Re=[],Ue=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],Be=J.Ry().shape({firstname:J.Z_().trim().required(a.translatedErrors.required),lastname:J.Z_(),email:J.Z_().email(a.translatedErrors.email).required(a.translatedErrors.required),roles:J.IX().min(1,a.translatedErrors.required).required(a.translatedErrors.required)}),Ie={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},Ee=({onSuccess:o,onToggle:y})=>{const[R,k]=(0,t.useState)("create"),[$,j]=(0,t.useState)(!1),[x,B]=(0,t.useState)(null),{formatMessage:D}=(0,n.Z)(),Q=(0,a.useNotification)(),{lockApp:L,unlockApp:i}=(0,a.useOverlayBlocker)(),{post:N}=(0,a.useFetchClient)(),I=(0,f.c)(Re,async()=>(await e.e(9329).then(e.bind(e,99329))).ROLE_LAYOUT,{combine(v,S){return[...v,S]},defaultValue:[]}),H=(0,f.c)(ue,async()=>(await e.e(9329).then(e.bind(e,99329))).FORM_INITIAL_VALUES,{combine(v,S){return{...v,...S}},defaultValue:ue}),K=(0,f.c)(Le.A,async()=>(await e.e(566).then(e.bind(e,20566))).MagicLinkEE),V=(0,m.useMutation)(v=>N("/admin/users",v),{async onSuccess({data:v}){B(v.data.registrationToken),await o(),ae(),j(!1)},onError(v){throw j(!1),Q({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),v},onSettled(){i()}}),w=D({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),te=async(v,{setErrors:S})=>{L(),j(!0);try{await V.mutateAsync(v)}catch(Y){i(),Y?.response?.data?.error.message==="Email already taken"&&S({email:Y.response.data.error.message})}},ae=()=>{h?k(h):y()},{buttonSubmitLabel:q,isDisabled:X,next:h}=Ie[R],be=R==="create"?t.createElement(T.z,{type:"submit",loading:$},D(q)):t.createElement(T.z,{type:"button",loading:$,onClick:y},D(q));return K?t.createElement(he.P,{onClose:y,labelledBy:"title"},t.createElement(ve.x,null,t.createElement(Ae.O,{label:w},t.createElement(De.$,{isCurrent:!0},w))),t.createElement(Te.J9,{enableReinitialize:!0,initialValues:H,onSubmit:te,validationSchema:Be,validateOnChange:!1},({errors:v,handleChange:S,values:Y})=>t.createElement(a.Form,null,t.createElement(Pe.f,null,t.createElement(z.k,{direction:"column",alignItems:"stretch",gap:6},R!=="create"&&t.createElement(K,{registrationToken:x}),t.createElement(M.x,null,t.createElement(Z.Z,{variant:"beta",as:"h2"},D({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})),t.createElement(M.x,{paddingTop:4},t.createElement(z.k,{direction:"column",alignItems:"stretch",gap:1},t.createElement(me.r,{gap:5},Ue.map(de=>de.map(U=>t.createElement(ie.P,{key:U.name,...U.size},t.createElement(a.GenericInput,{...U,disabled:X,error:v[U.name],onChange:S,value:Y[U.name]})))))))),t.createElement(M.x,null,t.createElement(Z.Z,{variant:"beta",as:"h2"},D({id:"global.roles",defaultMessage:"User's role"})),t.createElement(M.x,{paddingTop:4},t.createElement(me.r,{gap:5},t.createElement(ie.P,{col:6,xs:12},t.createElement(Oe.Z,{disabled:X,error:v.roles,onChange:S,value:Y.roles})),I.map(de=>de.map(U=>t.createElement(ie.P,{key:U.name,...U.size},t.createElement(a.GenericInput,{...U,disabled:X,onChange:S,value:Y[U.name]}))))))))),t.createElement(Ce.m,{startActions:t.createElement(T.z,{variant:"tertiary",onClick:y,type:"button"},D({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:be})))):null};Ee.propTypes={onToggle:u().func.isRequired,onSuccess:u().func.isRequired};const Se=Ee,ce=({pagination:o})=>t.createElement(M.x,{paddingTop:4},t.createElement(z.k,{alignItems:"flex-end",justifyContent:"space-between"},t.createElement(a.PageSizeURLQuery,null),t.createElement(a.PaginationURLQuery,{pagination:o})));ce.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},ce.propTypes={pagination:u().shape({page:u().number,pageCount:u().number,pageSize:u().number,total:u().number})};const We=ce,xe=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],Ke=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:o},{formatMessage:y}){return t.createElement(Z.Z,{textColor:"neutral800"},o.map(R=>y({id:`Settings.permissions.users.${R.code}`,defaultMessage:R.name})).join(`,
`))}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:o},{formatMessage:y}){return t.createElement(z.k,null,t.createElement(a.Status,{isActive:o,variant:o?"success":"danger"}),t.createElement(Z.Z,{textColor:"neutral800"},y({id:o?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:o?"Active":"Inactive"})))}}],ge=["ee","license-limit-info"],pe=()=>{const{post:o}=(0,a.useFetchClient)(),{formatAPIError:y}=(0,a.useAPIErrorHandler)(),[R,k]=(0,t.useState)(!1),$=(0,P.v9)(A._),{allowedActions:{canCreate:j,canDelete:x,canRead:B}}=(0,a.useRBAC)($.settings.users),D=(0,m.useQueryClient)(),Q=(0,a.useNotification)(),{formatMessage:L}=(0,n.Z)(),{search:i}=(0,C.TH)();(0,a.useFocusWhenNavigate)();const{users:N,pagination:I,isError:H,isLoading:K,refetch:V}=(0,p.R)(g().parse(i,{ignoreQueryPrefix:!0}),{cacheTime:0,enabled:B}),w=(0,f.c)(_,async()=>(await e.e(5833).then(e.bind(e,85833))).CreateActionEE),te=Ke.map(h=>({...h,metadatas:{...h.metadatas,label:L(h.metadatas.label)}})),ae=L({id:"global.users",defaultMessage:"Users"}),q=()=>{k(h=>!h)},X=(0,m.useMutation)(async h=>{await o("/admin/users/batch-delete",{ids:h})},{async onSuccess(){await V(),await D.refetchQueries(ge)},onError(h){Q({type:"warning",message:{id:"notification.error",message:y(h),defaultMessage:"An error occured"}})}});return w?t.createElement(d.o,{"aria-busy":K},t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(r.T,{primaryAction:j&&t.createElement(w,{onClick:q}),title:ae,subtitle:L({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),B&&t.createElement(l.Z,{startActions:t.createElement(t.Fragment,null,t.createElement(a.SearchURLQuery,{label:L({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:ae})}),t.createElement(O.Z,{displayedFilters:xe}))}),t.createElement(E.D,{canRead:B},!B&&t.createElement(a.NoPermissions,null),H&&t.createElement("div",null,"TODO: An error occurred"),B&&t.createElement(t.Fragment,null,t.createElement(a.DynamicTable,{contentType:"Users",isLoading:K,onConfirmDeleteAll:X.mutateAsync,onConfirmDelete:h=>X.mutateAsync([h]),headers:te,rows:N,withBulkActions:!0,withMainAction:x},t.createElement(ye,{canDelete:x,headers:te,rows:N,withBulkActions:!0,withMainAction:x})),I&&t.createElement(We,{pagination:I}))),R&&t.createElement(Se,{onSuccess:async()=>{await V(),await D.refetchQueries(ge)},onToggle:q})):null},Fe=()=>{const o=(0,f.c)(pe,async()=>(await e.e(5481).then(e.bind(e,17403))).UserListPageEE);return o?t.createElement(o,null):null}},87901:(W,c,e)=>{e.r(c),e.d(c,{default:()=>s});var t=e(27279),d=e(61166),r=e(49402),l=e(36364),E=e(61611);const s=()=>{const g=(0,r.v9)(l._);return t.createElement(d.CheckPagePermissions,{permissions:g.settings.users.main},t.createElement(E.Z,null))}},6324:(W,c,e)=>{e.d(c,{Z:()=>n});var t=e(27279),d=e(2667),r=e(61166),l=e(20049),E=e(70627),a=e.n(E),s=e(26781);const g=({children:m,target:P})=>{const C=(0,r.useNotification)(),{formatMessage:p}=(0,s.Z)(),{copy:f}=(0,r.useClipboard)(),A=p({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),O=async()=>{await f(P)&&C({type:"info",message:{id:"notification.link-copied"}})};return t.createElement(r.ContentBox,{endAction:t.createElement(d.h,{label:A,noBorder:!0,icon:t.createElement(l.Z,null),onClick:O}),title:P,titleEllipsis:!0,subtitle:m,icon:t.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};g.propTypes={children:a().oneOfType([a().element,a().string]).isRequired,target:a().string.isRequired};const n=g},30164:(W,c,e)=>{e.d(c,{A:()=>s});var t=e(27279),d=e(70627),r=e.n(d),l=e(26781),E=e(95651),a=e(6324);const s=({registrationToken:g})=>{const{formatMessage:n}=(0,l.Z)(),m=`${window.location.origin}${E.Z}auth/register?registrationToken=${g}`;return t.createElement(a.Z,{target:m},n({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};s.defaultProps={registrationToken:""},s.propTypes={registrationToken:r().string}},85243:(W,c,e)=>{e.d(c,{Z:()=>O});var t=e(27279),d=e(52870),r=e(33699),l=e(61166),E=e(30085),a=e(70627),s=e.n(a),g=e(26781),n=e(40464),m=e(72450);const P=(0,m.keyframes)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,C=m.default.div`
  animation: ${P} 2s infinite linear;
`,p=()=>t.createElement(C,null,t.createElement(E.Z,null)),f=async()=>{const{get:T}=(0,l.getFetchClient)(),{data:F}=await T("/admin/roles");return F.data},A=({disabled:T,error:F,onChange:se,value:u})=>{const{status:_,data:ne}=(0,n.useQuery)(["roles"],f,{staleTime:5e4}),{formatMessage:b}=(0,g.Z)(),G=F?b({id:F,defaultMessage:F}):"",le=b({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),Z=b({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),z=b({id:"app.components.Select.placeholder",defaultMessage:"Select"}),ee=_==="loading"?t.createElement(p,null):void 0;return t.createElement(d.P,{id:"roles",disabled:T,error:G,hint:Z,label:le,name:"roles",onChange:M=>{se({target:{name:"roles",value:M}})},placeholder:z,multi:!0,startIcon:ee,value:u.map(M=>M.toString()),withTags:!0,required:!0},(ne||[]).map(M=>t.createElement(r.W,{key:M.id,value:M.id.toString()},b({id:`global.${M.code}`,defaultMessage:M.name}))))};A.defaultProps={disabled:!1,error:void 0},A.propTypes={disabled:s().bool,error:s().string,onChange:s().func.isRequired,value:s().array.isRequired};const O=A},89486:(W,c,e)=>{e.d(c,{O:()=>n});var t=e(74081),d=e(27279),r=e(72450),l=e(93415),E=e(32370);const a=()=>(0,t.jsx)(l.x,{"aria-hidden":!0,paddingLeft:1,paddingRight:1,children:(0,t.jsx)(E.Z,{variant:"pi",textColor:"neutral500",children:"/"})});a.displayName="Divider";var s=e(10701);const g=(0,r.default)(s.k)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:m})=>`calc(-1*${m.spaces[2]})`};
  }
`,n=({label:m,children:P,...C})=>{const p=d.Children.toArray(P);return(0,t.jsx)(l.x,{"aria-label":m,...C,children:(0,t.jsx)(g,{as:"ol",children:d.Children.map(p,(f,A)=>{const O=p.length>1&&A+1<p.length;return(0,t.jsxs)(s.k,{inline:!0,as:"li",children:[f,O&&(0,t.jsx)(a,{})]})})})})};n.displayName="Breadcrumbs"},82298:(W,c,e)=>{e.d(c,{$:()=>l});var t=e(74081),d=e(93415),r=e(32370);const l=({children:E,isCurrent:a=!1,...s})=>(0,t.jsx)(d.x,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1,children:(0,t.jsx)(r.Z,{variant:"pi",textColor:"neutral800",fontWeight:a?"bold":"normal","aria-current":a,...s,children:E})});l.displayName="Crumb"}}]);
