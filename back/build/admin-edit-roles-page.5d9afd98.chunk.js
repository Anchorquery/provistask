(self.webpackChunkserver_provitask=self.webpackChunkserver_provitask||[]).push([[2544],{4644:(W,I,r)=>{"use strict";r.d(I,{V:()=>$});var e=r(61166),v=r(40464);const $=(f={},S={})=>{const{id:R,...b}=f,{get:D}=(0,e.useFetchClient)();if(!R&&(S?.enabled===void 0||S?.enabled))throw new Error('"id" is a required argument');const{data:F,error:V,isError:a,isLoading:j,refetch:y}=(0,v.useQuery)(["roles",R,"permissions",b],async()=>{const{data:{data:te}}=await D(`/admin/roles/${R}/permissions`,{params:b});return te},S);return{permissions:F,error:V,isError:a,isLoading:j,refetch:y}}},51754:(W,I,r)=>{"use strict";r.d(I,{F:()=>f});var e=r(61166),v=r(26781),$=r(40464);const f=(S={},R={})=>{const{id:b="",...D}=S,{get:F}=(0,e.useFetchClient)(),{locale:V}=(0,v.Z)(),a=(0,e.useCollator)(V,{sensitivity:"base"}),{data:j,error:y,isError:te,isLoading:de,refetch:C}=(0,$.useQuery)(["roles",b,D],async()=>{const{data:U}=await F(`/admin/roles/${b??""}`,{params:D});return U},R);let x=[];return b&&j?x=[j.data]:Array.isArray(j?.data)&&(x=j.data),{roles:x.sort((U,ge)=>a.compare(U.name,ge.name)),error:y,isError:te,isLoading:de,refetch:C}}},25545:(W,I,r)=>{"use strict";r.r(I),r.d(I,{CreatePage:()=>ke,default:()=>je});var e=r(27279),v=r(796),$=r(34041),f=r(85898),S=r(51413),R=r(49969),b=r(52185),D=r(35557),F=r(90529),V=r(49899),a=r(19098),j=r(87549),y=r(61166),te=r(98447),de=r(84260),C=r(71563),x=r(10124),U=r.n(x),ge=r(26781),$e=r(49402),Ee=r(51447),P=r(72450),Le=r(4644),Te=r(36364),Y=r(442),ue=r(90065),ve=r(47853);const Se=ve.Ry().shape({name:ve.Z_().required(y.translatedErrors.required),description:ve.Z_().required(y.translatedErrors.required)}),fe=P.default.div`
  border: 1px solid ${({theme:H})=>H.colors.primary200};
  background: ${({theme:H})=>H.colors.primary100};
  padding: ${({theme:H})=>`${H.spaces[2]} ${H.spaces[4]}`};
  color: ${({theme:H})=>H.colors.primary600};
  border-radius: ${({theme:H})=>H.borderRadius};
  font-size: ${12/16}rem;
  font-weight: bold;
`,ke=()=>{const H=(0,Ee.$B)("/settings/roles/duplicate/:id"),z=(0,y.useNotification)(),{lockApp:ne,unlockApp:X}=(0,y.useOverlayBlocker)(),{formatMessage:k}=(0,ge.Z)(),[J,le]=(0,e.useState)(!1),{replace:re}=(0,Ee.k6)(),G=(0,e.useRef)(),{trackUsage:se}=(0,y.useTracking)(),{post:Ie,put:Fe}=(0,y.useFetchClient)(),{params:me}=H??{},{isLoading:Be,data:Pe}=(0,ue.d)(me?.id,{cacheTime:0}),{permissions:ce,isLoading:be}=(0,Le.V)({id:me?.id},{cacheTime:0,enabled:!!me?.id}),Ne=he=>{ne(),le(!0),me?.id?se("willDuplicateRole"):se("willCreateNewRole"),Promise.resolve(Ie("/admin/roles",he)).then(async({data:w})=>{const{permissionsToSend:_}=G.current.getPermissions();return me?.id?se("didDuplicateRole"):se("didCreateNewRole"),w.data.id&&!U()(_)&&await Fe(`/admin/roles/${w.data.id}/permissions`,{permissions:_}),w}).then(w=>{le(!1),z({type:"success",message:{id:"Settings.roles.created",defaultMessage:"created"}}),re(`/settings/roles/${w.data.id}`)}).catch(w=>{console.error(w),le(!1),z({type:"warning",message:{id:"notification.error"}})}).finally(()=>{X()})},Ge=`${k({id:"Settings.roles.form.created",defaultMessage:"Created"})} ${(0,de.Z)(new Date,"PPP")}`;return e.createElement(v.o,null,e.createElement(y.SettingsPageTitle,{name:"Roles"}),e.createElement(C.J9,{initialValues:{name:"",description:Ge},onSubmit:Ne,validationSchema:Se,validateOnChange:!1},({handleSubmit:he,values:w,errors:_,handleReset:ee,handleChange:oe})=>e.createElement(y.Form,{noValidate:!0},e.createElement(e.Fragment,null,e.createElement($.T,{primaryAction:e.createElement(f.k,{gap:2},e.createElement(S.z,{variant:"secondary",onClick:()=>{ee(),G.current.resetForm()},size:"L"},k({id:"app.components.Button.reset",defaultMessage:"Reset"})),e.createElement(S.z,{onClick:he,loading:J,size:"L"},k({id:"global.save",defaultMessage:"Save"}))),title:k({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:k({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(y.Link,{startIcon:e.createElement(te.Z,null),to:"/settings/roles"},k({id:"global.back",defaultMessage:"Back"}))}),e.createElement(R.D,null,e.createElement(f.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(b.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(f.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(f.k,{justifyContent:"space-between"},e.createElement(b.x,null,e.createElement(b.x,null,e.createElement(D.Z,{fontWeight:"bold"},k({id:"global.details",defaultMessage:"Details"}))),e.createElement(b.x,null,e.createElement(D.Z,{variant:"pi",textColor:"neutral600"},k({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(fe,null,k({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:0}))),e.createElement(F.r,{gap:4},e.createElement(V.P,{col:6},e.createElement(a.o,{name:"name",error:_.name&&k({id:_.name}),label:k({id:"global.name",defaultMessage:"Name"}),onChange:oe,required:!0,value:w.name})),e.createElement(V.P,{col:6},e.createElement(j.g,{label:k({id:"global.description",defaultMessage:"Description"}),id:"description",error:_.description&&k({id:_.description}),onChange:oe},w.description))))),!Be&&!be?e.createElement(b.x,{shadow:"filterShadow",hasRadius:!0},e.createElement(Y.Z,{isFormDisabled:!1,ref:G,permissions:ce,layout:Pe})):e.createElement(b.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(y.LoadingIndicatorPage,null))))))))};function je(){const H=(0,$e.v9)(Te._);return e.createElement(y.CheckPagePermissions,{permissions:H.settings.roles.create},e.createElement(ke,null))}},442:(W,I,r)=>{"use strict";r.d(I,{Z:()=>ts});var e=r(27279),v=r(12826),$=r(87161),f=r(33832),S=r(61166),R=r(10131),b=r.n(R),D=r(10124),F=r.n(D),V=r(70627),a=r.n(V),j=r(26781),y=r(52185),te=r(8243),de=r.n(te),C=r(72450),x=r(85898),U=r(83667),ge=r(46078),$e=r(34268),Ee=r(98934),P=r.n(Ee),Le=r(74919),Te=r.n(Le),Y=r(92807),ue=r(51413),ve=r(18602);const De=C.default.div`
  position: relative;

  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: -3px;
      left: -10px;
      width: 6px;
      height: 6px;
      border-radius: ${20/16}rem;;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,Se=({onClick:t,className:n,hasConditions:o,variant:s})=>{const{formatMessage:i}=(0,j.Z)();return e.createElement(De,{hasConditions:o,className:n},e.createElement(ue.z,{variant:s,startIcon:e.createElement(ve.Z,null),onClick:t},i({id:"global.settings",defaultMessage:"Settings"})))};Se.defaultProps={className:null,hasConditions:!1,variant:"tertiary"},Se.propTypes={onClick:a().func.isRequired,className:a().string,hasConditions:a().bool,variant:a().string};const fe=(0,C.default)(Se)``;var ke=r(81565),je=r(37386),H=r(23851),z=r(35557),ne=r(3785),X=r(89486),k=r(82298),J=r(61815),le=r(63799),re=r.n(le),G=r(51943),se=r.n(G),Ie=r(14291);const Fe=t=>Object.values(t).map(n=>Object.entries(n).filter(([,o])=>o).map(([o])=>o)).flat(),me=t=>t.reduce((n,[o,s])=>(n.push({label:se()(o),children:s.map(i=>({label:i.displayName,value:i.id}))}),n),[]),Be=(t,n)=>t.map(([,o])=>o).flat().reduce((o,s)=>({[s.id]:n.includes(s.id),...o}),{}),Pe=({arrayOfOptionsGroupedByCategory:t,isFormDisabled:n,isGrey:o,label:s,name:i,onChange:l,value:c})=>{const{formatMessage:d}=(0,j.Z)(),m=u=>{l(i,Be(t,u))};return e.createElement(x.k,{as:"li",background:o?"neutral100":"neutral0",paddingBottom:3,paddingTop:3},e.createElement(x.k,{paddingLeft:6,style:{width:180}},e.createElement(z.Z,{variant:"sigma",textColor:"neutral600"},d({id:"Settings.permissions.conditions.can",defaultMessage:"Can"}),"\xA0"),e.createElement(z.Z,{variant:"sigma",title:s,textColor:"primary600",ellipsis:!0},d({id:`Settings.roles.form.permissions.${s.toLowerCase()}`,defaultMessage:s})),e.createElement(z.Z,{variant:"sigma",textColor:"neutral600"},"\xA0",d({id:"Settings.permissions.conditions.when",defaultMessage:"When"}))),e.createElement(y.x,{style:{maxWidth:430,width:"100%"}},e.createElement(Ie.Q,{id:i,customizeContent:u=>`${u.length} currently selected`,onChange:m,value:Fe(c),options:me(t),disabled:n})))};Pe.propTypes={arrayOfOptionsGroupedByCategory:a().array.isRequired,isFormDisabled:a().bool.isRequired,isGrey:a().bool.isRequired,label:a().string.isRequired,name:a().string.isRequired,value:a().object.isRequired,onChange:a().func.isRequired};const ce=Pe,be=(t,n)=>t.reduce((o,s)=>(o[s.id]=P()(n,s.id,!1),o),{}),Ne=(t,n)=>t.reduce((o,s)=>{const[i,l]=s,c=be(l,n);return o[i]=c,o},{}),he=(t,n,o)=>t.reduce((s,i)=>{const l=P()(n,[...i.pathToConditionsObject,"conditions"],{}),c=Ne(o,l);return s[i.pathToConditionsObject.join("..")]=c,s},{}),w=({actions:t,headerBreadCrumbs:n,isFormDisabled:o,onClosed:s,onToggle:i})=>{const{formatMessage:l}=(0,j.Z)(),{availableConditions:c,modifiedData:d,onChangeConditions:m}=(0,Y.$_)(),u=(0,e.useMemo)(()=>Object.entries(re()(c,"category")),[c]),p=t.filter(({isDisplayed:g,hasSomeActionsSelected:M,hasAllActionsSelected:T})=>g&&(M||T)),h=(0,e.useMemo)(()=>he(p,d,u),[p,d,u]),[A,B]=(0,e.useState)(h),O=(g,M)=>{B((0,J.ZP)(T=>{T[g]||(T[g]={}),T[g].default||(T[g].default={}),T[g].default=M}))},E=()=>{const g=Object.entries(A).reduce((M,T)=>{const[L,Q]=T,Z=Object.values(Q).reduce((K,N)=>({...K,...N}),{});return M[L]=Z,M},{});m(g),i()};return e.createElement(ke.P,{labelledBy:"condition-modal-breadcrumbs",onClose:s},e.createElement(je.x,null,e.createElement(X.O,{id:"condition-modal-breadcrumbs",label:n.join(", ")},n.map((g,M,T)=>e.createElement(k.$,{isCurrent:M===T.length-1,key:g},se()(l({id:g,defaultMessage:g})))))),e.createElement(H.f,null,p.length===0&&e.createElement(z.Z,null,l({id:"Settings.permissions.conditions.no-actions",defaultMessage:"You first need to select actions (create, read, update, ...) before defining conditions on them."})),e.createElement("ul",null,p.map(({actionId:g,label:M,pathToConditionsObject:T},L)=>{const Q=T.join("..");return e.createElement(ce,{key:g,arrayOfOptionsGroupedByCategory:u,label:M,isFormDisabled:o,isGrey:L%2===0,name:Q,onChange:O,value:P()(A,Q,{})})}))),e.createElement(ne.m,{startActions:e.createElement(ue.z,{variant:"tertiary",onClick:i},l({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:e.createElement(ue.z,{onClick:E},l({id:"Settings.permissions.conditions.apply",defaultMessage:"Apply"}))}))};w.propTypes={actions:a().arrayOf(a().shape({actionId:a().string.isRequired,checkboxName:a().string,hasSomeActionsSelected:a().bool.isRequired,hasAllActionsSelected:a().bool,isDisplayed:a().bool.isRequired,label:a().string})).isRequired,headerBreadCrumbs:a().arrayOf(a().string).isRequired,isFormDisabled:a().bool.isRequired,onClosed:a().func.isRequired,onToggle:a().func.isRequired};const _=w,ee=`${120/16}rem`,oe=`${200/16}rem`,ye=`${53/16}rem`,Ze=C.default.div`
  width: ${ee};
`,rt=(0,C.default)(x.k)`
  padding-right: ${({theme:t})=>t.spaces[2]};
  overflow: hidden;
  flex: 1;
  ${({isCollapsable:t})=>t&&"cursor: pointer;"}
`,Ue=({children:t,isCollapsable:n,isActive:o,isFormDisabled:s,label:i,onChange:l,onClick:c,checkboxName:d,someChecked:m,value:u})=>{const{formatMessage:p}=(0,j.Z)();return e.createElement(x.k,{alignItems:"center",paddingLeft:6,style:{width:oe,flexShrink:0}},e.createElement(y.x,{paddingRight:2},e.createElement(U.C,{name:d,"aria-label":p({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:i}),disabled:s,onValueChange:h=>l({target:{name:d,value:h}}),indeterminate:m,value:u})),e.createElement(rt,{title:i,alignItems:"center",isCollapsable:n,...n&&{onClick:c,"aria-expanded":o,onKeyDown:({key:h})=>(h==="Enter"||h===" ")&&c(),tabIndex:0,role:"button"}},e.createElement(z.Z,{fontWeight:o?"bold":"",textColor:o?"primary600":"neutral800",ellipsis:!0},se()(i)),t))};Ue.defaultProps={children:null,checkboxName:"",onChange(){},value:!1,someChecked:!1,isCollapsable:!1},Ue.propTypes={checkboxName:a().string,children:a().node,label:a().string.isRequired,isCollapsable:a().bool,isFormDisabled:a().bool.isRequired,onChange:a().func,onClick:a().func.isRequired,someChecked:a().bool,value:a().bool,isActive:a().bool.isRequired};const at=(0,e.memo)(Ue);var Zt=r(39738),Vt=r.n(Zt),Wt=r(3243),Ce=r.n(Wt);const it=t=>Ce()(t)?Vt()(Object.values(t).map(n=>Ce()(n)?it(n):n)):[],Oe=it,ze=t=>t?Object.keys(t).reduce((n,o)=>(o!=="conditions"&&(n[o]=t[o]),n),{}):null,Re=t=>{const n=ze(t),o=Oe(n);if(!o.length)return{hasAllActionsSelected:!1,hasSomeActionsSelected:!1};const s=o.every(l=>l),i=o.some(l=>l)&&!s;return{hasAllActionsSelected:s,hasSomeActionsSelected:i}};var Ht=r(3494);const Ve=(0,C.default)(Ht.Z)`
  display: none;
  width: ${10/16}rem;
  transform: rotate(${({$isActive:t})=>t?"180":"0"}deg);
  margin-left: ${({theme:t})=>t.spaces[2]};
`,We=t=>`
  ${z.Z} {
    color: ${t.colors.primary600};
    font-weight: ${t.fontWeights.bold}
  }
  ${Ve} {
    display: block;
    path {
      fill: ${t.colors.primary600}
    };
  }
`,Gt=(t,n,o)=>t.map(({actionId:s,isDisplayed:i,applyToProperties:l,label:c})=>{if(!i)return{actionId:s,hasSomeActionsSelected:!1,isDisplayed:i};const d=[...o.split(".."),s],m=F()(l)?[...d,"properties","enabled"]:d,u=m.join(".."),p=P()(n,[...d,"conditions"],null),h=Oe(p).some(E=>E);if(F()(l)){const E=P()(n,m,!1);return{actionId:s,checkboxName:u,hasAllActionsSelected:E,hasConditions:h,hasSomeActionsSelected:E,isDisplayed:i,isParentCheckbox:!1,label:c,pathToConditionsObject:d}}const A=P()(n,m,null),{hasAllActionsSelected:B,hasSomeActionsSelected:O}=Re(A);return{actionId:s,checkboxName:u,hasAllActionsSelected:B,hasConditions:h,hasSomeActionsSelected:O,isDisplayed:i,isParentCheckbox:!0,label:c,pathToConditionsObject:d}}),Xe=(t,n)=>`
  ${lt} {
    background-color: ${t.colors.primary100};
    color: ${t.colors.primary600};
    border-radius: ${n?"2px 2px 0 0":"2px"};
  }
  ${dt} {
    display: flex;
  }
  ${fe} {
    display: block;
  }
  &:hover {
   ${We(t)}
  }

  &:focus-within {
    ${({theme:o,isActive:s})=>Xe(o,s)}
  }
  
`,lt=C.default.div`
  flex: 1;
  display: flex;
  align-items: center;
  height: ${ye};
  background-color: ${({isGrey:t,theme:n})=>t?n.colors.neutral100:n.colors.neutral0};
  border: 1px solid transparent;
`,Kt=C.default.div`
  display: inline-flex;
  min-width: 100%;

  ${fe} {
    display: none;
  }
  ${({isActive:t,theme:n})=>t&&Xe(n,t)}
  &:hover {
    ${({theme:t,isActive:n})=>Xe(t,n)}
  }
`,ct=(0,C.default)(x.k)`
  width: ${ee};
  position: relative;
`,dt=(0,C.default)(y.x)`
  display: none;
  svg {
    width: 11px;
  }
  * {
    fill: ${({theme:t})=>t.colors.primary600};
  }
`,ut=C.default.span`
  position: absolute;
  top: -6px;
  left: 37px;
  width: 6px;
  height: 6px;
  border-radius: 20px;
  background: ${({theme:t})=>t.colors.primary600};
`,Ut=(0,C.default)(y.x)`
  position: absolute;
  right: 9px;
  transform: translateY(10px);
`,mt=({availableActions:t,isActive:n,isGrey:o,isFormDisabled:s,label:i,onClickToggle:l,pathToData:c})=>{const[d,m]=(0,e.useState)(!1),{formatMessage:u}=(0,j.Z)(),{modifiedData:p,onChangeParentCheckbox:h,onChangeSimpleCheckbox:A}=(0,Y.$_)(),B=()=>{m(Z=>!Z)},O=()=>{m(!1)},E=P()(p,c.split(".."),{}),g=(0,e.useMemo)(()=>Object.keys(E).reduce((Z,K)=>(Z[K]=Te()(E[K],"conditions"),Z),{}),[E]),{hasAllActionsSelected:M,hasSomeActionsSelected:T}=Re(g),L=(0,e.useMemo)(()=>Gt(t,p,c),[t,p,c]),Q=L.some(({hasConditions:Z})=>Z);return e.createElement(Kt,{isActive:n},e.createElement(lt,{isGrey:o},e.createElement(at,{isCollapsable:!0,isFormDisabled:s,label:i,checkboxName:c,onChange:h,onClick:l,someChecked:T,value:M,isActive:n},e.createElement(dt,{paddingLeft:2},n?e.createElement(ge.Z,null):e.createElement($e.Z,null))),e.createElement(x.k,{style:{flex:1}},L.map(({actionId:Z,hasConditions:K,hasAllActionsSelected:N,hasSomeActionsSelected:ie,isDisplayed:Me,isParentCheckbox:q,checkboxName:pe,label:He})=>Me?q?e.createElement(ct,{key:Z,justifyContent:"center",alignItems:"center"},K&&e.createElement(ut,null),e.createElement(U.C,{disabled:s,name:pe,"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${He} ${i}`}),onValueChange:xe=>{h({target:{name:pe,value:xe}})},indeterminate:ie,value:N})):e.createElement(ct,{key:Z,justifyContent:"center",alignItems:"center"},K&&e.createElement(ut,null),e.createElement(U.C,{disabled:s,indeterminate:K,name:pe,onValueChange:xe=>{A({target:{name:pe,value:xe}})},value:N})):e.createElement(Ze,{key:Z}))),d&&e.createElement(_,{headerBreadCrumbs:[i,"Settings.permissions.conditions.conditions"],actions:L,isFormDisabled:s,onClosed:O,onToggle:B})),e.createElement(Ut,null,e.createElement(fe,{onClick:B,hasConditions:Q})))};mt.propTypes={availableActions:a().array.isRequired,isActive:a().bool.isRequired,isGrey:a().bool.isRequired,isFormDisabled:a().bool.isRequired,label:a().string.isRequired,onClickToggle:a().func.isRequired,pathToData:a().string.isRequired};const zt=mt,Xt=C.default.span`
  color: ${({theme:t})=>t.colors.danger700};
  padding-left: ${({theme:t})=>t.spaces[1]}px;
`,pt=()=>e.createElement(Xt,null,"*"),Yt=(t,n)=>t.map(o=>{const s=Array.isArray(o.subjects)&&o.subjects.indexOf(n)!==-1;return{...o,isDisplayed:s}}),wt=(0,C.default)(y.x)`
  transform: translate(-4px, -12px);

  &:before {
    content: '';
    width: ${4/16}rem;
    height: ${12/16}rem;
    background: ${({theme:t})=>t.colors.primary200};
    display: block;
  }
`,Qt=C.default.svg`
  position: relative;
  flex-shrink: 0;
  transform: translate(-0.5px, -1px);

  * {
    fill: ${({theme:t,color:n})=>t.colors[n]};
  }
`,Ye=t=>e.createElement(wt,null,e.createElement(Qt,{width:"20",height:"23",viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.02477 14.7513C8.65865 17.0594 11.6046 18.6059 17.5596 18.8856C18.6836 18.9384 19.5976 19.8435 19.5976 20.9688V20.9688C19.5976 22.0941 18.6841 23.0125 17.5599 22.9643C10.9409 22.6805 6.454 20.9387 3.75496 17.1258C0.937988 13.1464 0.486328 7.39309 0.486328 0.593262H4.50974C4.50974 7.54693 5.06394 11.9813 7.02477 14.7513Z",fill:"#D9D8FF"})));Ye.defaultProps={fill:"primary200"},Ye.propTypes={fill:a().string};const Jt=(0,e.memo)(Ye),gt=(0,C.default)(x.k)`
  width: ${ee};
  position: relative;
`,qt=(0,C.default)(x.k)`
  height: ${ye};
`,_t=(0,C.default)(y.x)`
  padding-left: ${31/16}rem;
`,en=(0,C.default)(y.x)`
  border-left: ${({isVisible:t,theme:n})=>t?`4px solid ${n.colors.primary200}`:"4px solid transparent"};
`,tn=(0,C.default)(x.k)`
  padding-left: ${({theme:t})=>t.spaces[4]};
  width: ${({level:t})=>145-t*36}px;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${Ve} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${We(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&We(n)};
`,nn=C.default.div`
  padding-top: ${({theme:t})=>t.spaces[2]};
  margin-top: ${({theme:t})=>t.spaces[2]};
  width: ${4/16}rem;
  background-color: ${({theme:t})=>t.colors.primary200};
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
`,we=({childrenForm:t,isFormDisabled:n,recursiveLevel:o,pathToDataFromActionRow:s,propertyActions:i,parentName:l,propertyName:c})=>{const{formatMessage:d}=(0,j.Z)(),{modifiedData:m,onChangeParentCheckbox:u,onChangeSimpleCheckbox:p}=(0,Y.$_)(),[h,A]=(0,e.useState)(null),B=E=>{A(g=>g===E?null:E)},O=(0,e.useMemo)(()=>h?t.find(({value:E})=>E===h):null,[h,t]);return e.createElement(_t,null,e.createElement(nn,null),t.map(({label:E,value:g,required:M,children:T},L)=>{const Q=L+1<t.length,Z=Array.isArray(T),K=h===g;return e.createElement(en,{key:g,isVisible:Q},e.createElement(qt,null,e.createElement(Jt,{color:"primary200"}),e.createElement(x.k,{style:{flex:1}},e.createElement(tn,{level:o,isActive:K,isCollapsable:Z},e.createElement(rt,{alignItems:"center",isCollapsable:Z,...Z&&{onClick:()=>B(g),"aria-expanded":K,onKeyDown:({key:N})=>(N==="Enter"||N===" ")&&B(g),tabIndex:0,role:"button"},title:E},e.createElement(z.Z,{ellipsis:!0},se()(E)),M&&e.createElement(pt,null),e.createElement(Ve,{$isActive:K}))),e.createElement(x.k,{style:{flex:1}},i.map(({actionId:N,label:ie,isActionRelatedToCurrentProperty:Me})=>{if(!Me)return e.createElement(Ze,{key:N});const q=[...s.split(".."),N,"properties",c,...l.split(".."),g],pe=P()(m,q,!1);if(!T)return e.createElement(gt,{key:ie,justifyContent:"center",alignItems:"center"},e.createElement(U.C,{disabled:n,name:q.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${l} ${E} ${ie}`}),onValueChange:Ae=>{p({target:{name:q.join(".."),value:Ae}})},value:pe}));const{hasAllActionsSelected:He,hasSomeActionsSelected:xe}=Re(pe);return e.createElement(gt,{key:ie,justifyContent:"center",alignItems:"center"},e.createElement(U.C,{key:ie,disabled:n,name:q.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${l} ${E} ${ie}`}),onValueChange:Ae=>{u({target:{name:q.join(".."),value:Ae}})},value:He,indeterminate:xe}))})))),O&&K&&e.createElement(y.x,{paddingBottom:2},e.createElement(we,{isFormDisabled:n,parentName:`${l}..${g}`,pathToDataFromActionRow:s,propertyActions:i,propertyName:c,recursiveLevel:o+1,childrenForm:O.children})))}))};we.propTypes={childrenForm:a().array.isRequired,isFormDisabled:a().bool.isRequired,parentName:a().string.isRequired,pathToDataFromActionRow:a().string.isRequired,propertyActions:a().array.isRequired,propertyName:a().string.isRequired,recursiveLevel:a().number.isRequired};const sn=(0,e.memo)(we),on=t=>t.reduce((o,s)=>(s.isActionRelatedToCurrentProperty&&o.push(s.actionId),o),[]),rn=(t,n,o,s,i)=>{const c=on(t).reduce((d,m)=>{const u=[...o.split(".."),m,"properties",s,i],p=P()(n,u,!1);return d[m]=p,d},{});return Re(c)},ft=(0,C.default)(x.k)`
  width: ${ee};
  position: relative;
`,an=(0,C.default)(x.k)`
  height: ${ye};
  flex: 1;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${Ve} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${We(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&We(n)};
`,Qe=({childrenForm:t,label:n,isFormDisabled:o,name:s,required:i,pathToData:l,propertyActions:c,propertyName:d,isOdd:m})=>{const{formatMessage:u}=(0,j.Z)(),[p,h]=(0,e.useState)(null),{modifiedData:A,onChangeCollectionTypeLeftActionRowCheckbox:B,onChangeParentCheckbox:O,onChangeSimpleCheckbox:E}=(0,Y.$_)(),g=p===s,M=(0,e.useMemo)(()=>Array.isArray(t)?t:[],[t]),T=M.length>0,L=(0,e.useCallback)(()=>{T&&h(N=>N===s?null:s)},[T,s]),Q=({target:{value:N}})=>{B(l,d,s,N)},{hasAllActionsSelected:Z,hasSomeActionsSelected:K}=(0,e.useMemo)(()=>rn(c,A,l,d,s),[c,A,l,d,s]);return e.createElement(e.Fragment,null,e.createElement(an,{alignItems:"center",isCollapsable:T,isActive:g,background:m?"neutral100":"neutral0"},e.createElement(x.k,null,e.createElement(at,{onChange:Q,onClick:L,isCollapsable:T,isFormDisabled:o,label:n,someChecked:K,value:Z,isActive:g},i&&e.createElement(pt,null),e.createElement(Ve,{$isActive:g})),e.createElement(x.k,null,c.map(({label:N,isActionRelatedToCurrentProperty:ie,actionId:Me})=>{if(!ie)return e.createElement(Ze,{key:N});const q=[...l.split(".."),Me,"properties",d,s];if(!T){const Ae=P()(A,q,!1);return e.createElement(ft,{key:Me,justifyContent:"center",alignItems:"center"},e.createElement(U.C,{disabled:o,name:q.join(".."),"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${N}`}),onValueChange:ns=>{E({target:{name:q.join(".."),value:ns}})},value:Ae}))}const pe=P()(A,q,{}),{hasAllActionsSelected:He,hasSomeActionsSelected:xe}=Re(pe);return e.createElement(ft,{key:N,justifyContent:"center",alignItems:"center"},e.createElement(U.C,{disabled:o,name:q.join(".."),onValueChange:Ae=>{O({target:{name:q.join(".."),value:Ae}})},"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${N}`}),value:He,indeterminate:xe}))})))),g&&e.createElement(sn,{childrenForm:M,isFormDisabled:o,parentName:s,pathToDataFromActionRow:l,propertyName:d,propertyActions:c,recursiveLevel:0}))};Qe.defaultProps={childrenForm:[],required:!1},Qe.propTypes={childrenForm:a().array,label:a().string.isRequired,isFormDisabled:a().bool.isRequired,name:a().string.isRequired,pathToData:a().string.isRequired,propertyActions:a().array.isRequired,propertyName:a().string.isRequired,required:a().bool,isOdd:a().bool.isRequired};const ln=(0,e.memo)(Qe),ht=(0,C.default)(x.k)`
  width: ${ee};
  flex-shrink: 0;
`,cn=(0,C.default)(x.k)`
  width: ${oe};
  height: ${ye};
  flex-shrink: 0;
`,yt=({headers:t,label:n})=>{const{formatMessage:o}=(0,j.Z)(),s=o({id:"Settings.roles.form.permission.property-label",defaultMessage:"{label} permissions"},{label:n});return e.createElement(x.k,null,e.createElement(cn,{alignItems:"center",paddingLeft:6},e.createElement(z.Z,{variant:"sigma",textColor:"neutral500"},s)),t.map(i=>i.isActionRelatedToCurrentProperty?e.createElement(ht,{justifyContent:"center",key:i.label},e.createElement(z.Z,{variant:"sigma",textColor:"neutral500"},o({id:`Settings.roles.form.permissions.${i.label.toLowerCase()}`,defaultMessage:i.label}))):e.createElement(ht,{key:i.label})))};yt.propTypes={headers:a().arrayOf(a().shape({label:a().string.isRequired,isActionRelatedToCurrentProperty:a().bool.isRequired})).isRequired,label:a().string.isRequired};const dn=yt,un=(t,n)=>t.map(o=>{const s=Array.isArray(o.applyToProperties)&&o.applyToProperties.indexOf(n)!==-1&&o.isDisplayed;return{label:o.label,actionId:o.actionId,isActionRelatedToCurrentProperty:s}}),mn=C.default.div`
  display: inline-flex;
  flex-direction: column;
  min-width: 0;
`,Ct=({availableActions:t,childrenForm:n,isFormDisabled:o,label:s,pathToData:i,propertyName:l})=>{const c=(0,e.useMemo)(()=>un(t,l),[t,l]);return e.createElement(mn,null,e.createElement(dn,{label:s,headers:c}),e.createElement(y.x,null,n.map(({children:d,label:m,value:u,required:p},h)=>e.createElement(ln,{childrenForm:d,key:u,label:m,isFormDisabled:o,name:u,required:p,propertyActions:c,pathToData:i,propertyName:l,isOdd:h%2===0}))))};Ct.propTypes={childrenForm:a().array.isRequired,availableActions:a().array.isRequired,isFormDisabled:a().bool.isRequired,label:a().string.isRequired,pathToData:a().string.isRequired,propertyName:a().string.isRequired};const pn=Ct,gn=C.default.div`
  flex-direction: column;
  display: inline-flex;
  min-width: 100%;
  ${({theme:t,isActive:n})=>n&&`border: 1px solid ${t.colors.primary600};`}
`,Et=({allActions:t,contentTypeName:n,label:o,index:s,isActive:i,isFormDisabled:l,onClickToggleCollapse:c,pathToData:d,properties:m})=>{const u=(0,e.useCallback)(()=>{c(n)},[n,c]),p=(0,e.useMemo)(()=>Yt(t,n),[t,n]);return e.createElement(gn,{isActive:i},e.createElement(zt,{availableActions:p,isActive:i,isGrey:s%2===0,isFormDisabled:l,label:o,onClickToggle:u,pathToData:d}),i&&m.map(({label:h,value:A,children:B})=>e.createElement(pn,{availableActions:p,childrenForm:B,isFormDisabled:l,label:h,pathToData:d,propertyName:A,key:A})))};Et.propTypes={allActions:a().array.isRequired,contentTypeName:a().string.isRequired,index:a().number.isRequired,isActive:a().bool.isRequired,isFormDisabled:a().bool.isRequired,label:a().string.isRequired,onClickToggleCollapse:a().func.isRequired,pathToData:a().string.isRequired,properties:a().array.isRequired};const fn=Et,Je=({actions:t,isFormDisabled:n,pathToData:o,subjects:s})=>{const[i,l]=(0,e.useState)(null),c=d=>{l(i===d?null:d)};return s.map(({uid:d,label:m,properties:u},p)=>e.createElement(fn,{allActions:t,key:d,contentTypeName:d,label:m,isActive:i===d,isFormDisabled:n,index:p,onClickToggleCollapse:c,pathToData:`${o}..${d}`,properties:u}))};Je.defaultProps={actions:[],subjects:[]},Je.propTypes={actions:a().array.isRequired,isFormDisabled:a().bool.isRequired,pathToData:a().string.isRequired,subjects:a().arrayOf(a().shape({uid:a().string.isRequired,label:a().string.isRequired,properties:a().array.isRequired}))};const hn=(0,e.memo)(Je),yn=t=>t.filter(({subjects:n})=>n&&n.length),Cn=t=>t.map(({actionId:n})=>n),En=(t,n)=>t.reduce((o,s)=>(Object.keys(n).forEach(i=>{const l=P()(n,[i,s],{}),c={[i]:ze(l)};o[s]?o[s]={...o[s],...c}:o[s]=c}),o),{}),vn=(t,n)=>{const o=Cn(t),s=En(o,n);return Object.keys(s).reduce((l,c)=>(l[c]=Re(s[c]),l),{})},bn=(0,C.default)(x.k)`
  width: ${ee};
  flex-shrink: 0;
`,qe=({actions:t,isFormDisabled:n,kind:o})=>{const{formatMessage:s}=(0,j.Z)(),{modifiedData:i,onChangeCollectionTypeGlobalActionCheckbox:l}=(0,Y.$_)(),c=(0,e.useMemo)(()=>yn(t),[t]),d=(0,e.useMemo)(()=>vn(c,i[o]),[i,c,o]);return e.createElement(y.x,{paddingBottom:4,paddingTop:6,style:{paddingLeft:oe}},e.createElement(x.k,{gap:0},c.map(({label:m,actionId:u})=>e.createElement(bn,{direction:"column",alignItems:"center",justifyContent:"center",key:u,gap:3},e.createElement(z.Z,{variant:"sigma",textColor:"neutral500"},s({id:`Settings.roles.form.permissions.${m.toLowerCase()}`,defaultMessage:m})),e.createElement(U.C,{disabled:n,onValueChange:p=>{l(o,u,p)},name:u,"aria-label":s({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:s({id:`Settings.roles.form.permissions.${m.toLowerCase()}`,defaultMessage:m})}),value:P()(d,[u,"hasAllActionsSelected"],!1),indeterminate:P()(d,[u,"hasSomeActionsSelected"],!1)})))))};qe.defaultProps={actions:[]},qe.propTypes={actions:a().arrayOf(a().shape({label:a().string.isRequired,actionId:a().string.isRequired,subjects:a().array.isRequired})),isFormDisabled:a().bool.isRequired,kind:a().string.isRequired};const Rn=(0,e.memo)(qe),xn=(0,C.default)(y.x)`
  overflow-x: auto;
`,vt=({isFormDisabled:t,kind:n,layout:{actions:o,subjects:s}})=>{const i=de()([...s],"label");return e.createElement(xn,{background:"neutral0"},e.createElement(Rn,{actions:o,kind:n,isFormDisabled:t}),e.createElement(hn,{actions:o,isFormDisabled:t,pathToData:n,subjects:i}))};vt.propTypes={isFormDisabled:a().bool.isRequired,kind:a().string.isRequired,layout:a().shape({actions:a().array,subjects:a().arrayOf(a().shape({uid:a().string.isRequired,label:a().string.isRequired,properties:a().array.isRequired}))}).isRequired};const bt=(0,e.memo)(vt);var An=r(18542);const Rt=({children:t,value:n})=>e.createElement(An.$l.Provider,{value:n},t);Rt.propTypes={children:a().node.isRequired,value:a().exact({availableConditions:a().array.isRequired,modifiedData:a().object.isRequired,onChangeCollectionTypeLeftActionRowCheckbox:a().func.isRequired,onChangeConditions:a().func.isRequired,onChangeSimpleCheckbox:a().func.isRequired,onChangeParentCheckbox:a().func.isRequired,onChangeCollectionTypeGlobalActionCheckbox:a().func.isRequired}).isRequired};const Tn=Rt;var Sn=r(83337),Pn=r(3408),On=r(82336),xt=r(31078),Mn=r(90529),$n=r(49899);const Ln=(t,n,o)=>t.map(s=>{const i=[...o,s.action,"properties","enabled"],l=P()(n,i,!1),c=P()(n,[...o,s.action,"conditions"],{}),d=Oe(c).some(m=>m);return{...s,isDisplayed:l,checkboxName:i.join(".."),hasSomeActionsSelected:l,value:l,hasConditions:d,label:s.displayName,actionId:s.action,pathToConditionsObject:[...o,s.action]}}),Dn=t=>{const n=Object.entries(t).reduce((s,i)=>{const[l,{conditions:c}]=i;return s[l]=c,s},{});return Oe(n).some(s=>s)},kn=C.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,jn=C.default.div`
  position: relative;
  word-break: keep-all;
  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: ${-4/16}rem;
      left: ${-8/16}rem;
      width: ${6/16}rem;
      height: ${6/16}rem;
      border-radius: ${20/16}rem;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,At=({categoryName:t,isFormDisabled:n,subCategoryName:o,actions:s,pathToData:i})=>{const[l,c]=(0,e.useState)(!1),{modifiedData:d,onChangeParentCheckbox:m,onChangeSimpleCheckbox:u}=(0,Y.$_)(),{formatMessage:p}=(0,j.Z)(),h=P()(d,i,{}),A=(0,e.useMemo)(()=>Object.keys(h).reduce((L,Q)=>(L[Q]=ze(h[Q]),L),{}),[h]),{hasAllActionsSelected:B,hasSomeActionsSelected:O}=Re(A),E=()=>{c(L=>!L)},g=()=>{c(!1)},M=Ln(s,d,i),T=Dn(P()(d,[...i],{}));return e.createElement(e.Fragment,null,e.createElement(y.x,null,e.createElement(x.k,{justifyContent:"space-between",alignItems:"center"},e.createElement(y.x,{paddingRight:4},e.createElement(z.Z,{variant:"sigma",textColor:"neutral600"},o)),e.createElement(kn,null),e.createElement(y.x,{paddingLeft:4},e.createElement(xt.X,{name:i.join(".."),disabled:n,onValueChange:L=>{m({target:{name:i.join(".."),value:L}})},indeterminate:O,value:B},p({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(x.k,{paddingTop:6,paddingBottom:6},e.createElement(Mn.r,{gap:2,style:{flex:1}},M.map(({checkboxName:L,value:Q,action:Z,displayName:K,hasConditions:N})=>e.createElement($n.P,{col:3,key:Z},e.createElement(jn,{disabled:n,hasConditions:N},e.createElement(xt.X,{name:L,disabled:n,onValueChange:ie=>{u({target:{name:L,value:ie}})},value:Q},K))))),e.createElement(fe,{hasConditions:T,onClick:E}))),l&&e.createElement(_,{headerBreadCrumbs:[t,o],actions:M,isFormDisabled:n,onClosed:g,onToggle:E}))};At.propTypes={actions:a().array.isRequired,categoryName:a().string.isRequired,isFormDisabled:a().bool.isRequired,subCategoryName:a().string.isRequired,pathToData:a().array.isRequired};const In=At,_e=({childrenForm:t,kind:n,name:o,isOpen:s,isFormDisabled:i,isWhite:l,onOpenCategory:c,pathToData:d})=>{const{formatMessage:m}=(0,j.Z)(),u=()=>{c(o)},p=(0,e.useMemo)(()=>o.split("::").pop(),[o]);return e.createElement(Sn.U,{expanded:s,onToggle:u,id:`accordion-${o}`,variant:l?"primary":"secondary"},e.createElement(Pn.B,{title:se()(p),description:`${m({id:"Settings.permissions.category"},{category:p})} ${n==="plugins"?"plugin":n}`}),e.createElement(On.v,null,e.createElement(y.x,{padding:6},t.map(({actions:h,subCategoryName:A,subCategoryId:B})=>e.createElement(In,{key:A,actions:h,categoryName:p,isFormDisabled:i,subCategoryName:A,pathToData:[...d,B]})))))};_e.defaultProps={},_e.propTypes={childrenForm:a().array.isRequired,isOpen:a().bool.isRequired,isFormDisabled:a().bool.isRequired,isWhite:a().bool.isRequired,kind:a().string.isRequired,name:a().string.isRequired,onOpenCategory:a().func.isRequired,pathToData:a().array.isRequired};const Fn=_e,Tt=({isFormDisabled:t,kind:n,layout:o})=>{const[s,i]=(0,e.useState)(null),l=c=>{i(c===s?null:c)};return e.createElement(y.x,{padding:6,background:"neutral0"},o.map(({category:c,categoryId:d,childrenForm:m},u)=>e.createElement(Fn,{key:c,childrenForm:m,kind:n,isFormDisabled:t,isOpen:s===c,isWhite:u%2===1,name:c,onOpenCategory:l,pathToData:[n,d]})))};Tt.propTypes={isFormDisabled:a().bool.isRequired,kind:a().string.isRequired,layout:a().arrayOf(a().shape({category:a().string.isRequired,categoryId:a().string.isRequired,childrenForm:a().arrayOf(a().shape({actions:a().array.isRequired})).isRequired}).isRequired).isRequired};const St=Tt;var Bn=r(87830),Nn=r.n(Bn),Zn=r(43433),ae=r.n(Zn);const Pt=(t,n,o)=>t.find(s=>s.action===n&&s.subject===o),Ot=(t,n=[])=>t.reduce((o,s)=>(o[s.id]=n.indexOf(s.id)!==-1,o),{}),Mt=({children:t},n,o="")=>t.reduce((s,i)=>{if(i.children)return{...s,[i.value]:Mt(i,n,`${o}${i.value}.`)};const l=n.indexOf(`${o}${i.value}`)!==-1;return s[i.value]=l,s},{}),Vn=(t,n,o)=>t.reduce((s,i)=>{const l=n.properties.find(({value:c})=>c===i);if(l){const c=P()(o,["properties",l.value],[]),d=Mt(l,c);s.properties[i]=d}return s},{properties:{}}),Wn=(t,n)=>n.reduce((o,s)=>{const i=t.find(({uid:l})=>l===s)||null;return i&&(o[s]=i),o},{}),$t=({subjects:t},n,o,s=[])=>n.reduce((i,l)=>{const c=l.subjects,d=Wn(t,c);if(F()(d))return i;const m=Object.keys(d).reduce((u,p)=>{const{actionId:h,applyToProperties:A}=l,E=d[p].properties.map(({value:L})=>L).every(L=>(A||[]).indexOf(L)===-1),g=Pt(s,h,p),M=Ot(o,P()(g,"conditions",[]));if(F()(A)||E)return ae()(u,[p,h],{properties:{enabled:g!==void 0},conditions:M}),u;const T=Vn(A,d[p],g);return ae()(u,[p,h],{...T,conditions:M}),u},{});return Nn()(i,m)},{}),Hn=(t,n,o)=>t.reduce((s,i)=>{const l=Pt(o,i.action,null);return s[i.action]={properties:{enabled:l!==void 0},conditions:Ot(n,l?.conditions??[])},s},{}),Gn=(t,n,o)=>t.reduce((s,i)=>(s[i.subCategoryId]=Hn(i.actions,n,o),s),{}),Lt=(t,n,o=[])=>t.reduce((s,{categoryId:i,childrenForm:l})=>{const c=Gn(l,n,o);return s[i]=c,s},{}),Dt=t=>t.split(" ").join("-"),kt=(t,n)=>Object.entries(re()(t,n)).map(([o,s])=>({category:o,categoryId:Dt(o),childrenForm:Object.entries(re()(s,"subCategory")).map(([i,l])=>({subCategoryName:i,subCategoryId:Dt(i),actions:l}))})),Kn=(t,n)=>{const{conditions:o,sections:{collectionTypes:s,singleTypes:i,plugins:l,settings:c}}=t,d={collectionTypes:s,singleTypes:i,plugins:kt(l,"plugin"),settings:kt(c,"category")},m={collectionTypes:$t(s,s.actions||[],o,n),singleTypes:$t(i,i.actions||[],o,n),plugins:Lt(d.plugins,o,n),settings:Lt(d.settings,o,n)};return{initialData:m,modifiedData:m,layouts:d}};var Un=r(8175),et=r.n(Un);const jt=t=>Object.keys(t).reduce((n,o)=>{const s=t[o];if(Ce()(s)&&!b()(s,"conditions"))return{...n,[o]:jt(s)};if(Ce()(s)&&b()(s,"conditions")&&!Oe(Te()(s,"conditions")).some(l=>l)){const l=Object.keys(s.conditions).reduce((c,d)=>(c[d]=!1,c),{});return{...n,[o]:{...s,conditions:l}}}return n[o]=s,n},{}),tt=jt,It=(t,n,o=!1)=>Object.keys(t).reduce((s,i)=>{const l=t[i];return i==="conditions"&&!o?(s[i]=l,s):Ce()(l)?{...s,[i]:It(l,n,i==="fields")}:(s[i]=n,s)},{}),Ke=It,zn={initialData:{},modifiedData:{},layouts:{}},Xn=(t,n)=>(0,J.ZP)(t,o=>{switch(n.type){case"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX":{const{collectionTypeKind:s,actionId:i,value:l}=n,c=["modifiedData",s];Object.keys(P()(t,c)).forEach(d=>{const m=P()(t,[...c,d,i],void 0);if(m){let u=Ke(m,l);if(!l&&u.conditions){const p=Ke(u.conditions,!1);u={...u,conditions:p}}ae()(o,[...c,d,i],u)}});break}case"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX":{const{pathToCollectionType:s,propertyName:i,rowName:l,value:c}=n;let d=et()(t.modifiedData);const m=s.split(".."),u=P()(d,m,{});Object.keys(u).forEach(p=>{if(b()(u[p],`properties.${i}`)){const h=P()(u,[p,"properties",i,l]),A=[...m,p,"properties",i,l];if(!Ce()(h))ae()(d,A,c);else{const B=Ke(h,c);ae()(d,A,B)}}}),c||(d=tt(d)),ae()(o,"modifiedData",d);break}case"ON_CHANGE_CONDITIONS":{Object.entries(n.conditions).forEach(s=>{const[i,l]=s;ae()(o,["modifiedData",...i.split(".."),"conditions"],l)});break}case"ON_CHANGE_SIMPLE_CHECKBOX":{let s=et()(t.modifiedData);ae()(s,[...n.keys.split("..")],n.value),n.value||(s=tt(s)),ae()(o,"modifiedData",s);break}case"ON_CHANGE_TOGGLE_PARENT_CHECKBOX":{const{keys:s,value:i}=n,l=[...s.split("..")];let c=et()(t.modifiedData);const d=P()(c,l,{}),m=Ke(d,i);ae()(c,l,m),i||(c=tt(c)),ae()(o,["modifiedData"],c);break}case"RESET_FORM":{o.modifiedData=t.initialData;break}case"SET_FORM_AFTER_SUBMIT":{o.initialData=t.modifiedData;break}default:return o}}),nt=t=>Object.entries(t).filter(([,n])=>n).map(([n])=>n),Yn=t=>{const[n,{conditions:o}]=t;return{action:n,subject:null,conditions:nt(o),properties:{}}},wn=t=>Object.values(t).reduce((n,o)=>{const s=Object.entries(o).reduce((i,l)=>{const[,{properties:{enabled:c}}]=l;if(!c)return i;const d=Yn(l);return i.push(d),i},[]);return[...n,...s]},[]),Ft=t=>Object.values(t).reduce((n,o)=>{const s=wn(o);return[...n,...s]},[]),Bt=(t,n="")=>Object.entries(t).reduce((o,s)=>{const[i,l]=s;return Ce()(l)?[...o,...Bt(l,`${n}${i}.`)]:(l&&!Ce()(l)&&o.push(`${n}${i}`),o)},[]),Qn=(t,n,{conditions:o,properties:s})=>Object.entries(s).reduce((i,l)=>{const[c,d]=l;return i.properties[c]=Bt(d),i},{action:t,subject:n,conditions:nt(o),properties:{}}),Jn=(t,n,{conditions:o})=>({action:t,subject:n,properties:{},conditions:nt(o)}),qn=(t,n)=>Object.entries(n).reduce((s,i)=>{const[l,c]=i;if(!Oe(c).some(u=>u))return s;if(!c?.properties?.enabled){const u=Qn(l,t,c);return[...s,u]}if(!c.properties.enabled)return s;const m=Jn(l,t,c);return s.push(m),s},[]),Nt=t=>Object.entries(t).reduce((o,s)=>{const[i,l]=s,c=qn(i,l);return[...o,...c]},[]),_n=t=>{const n=Ft(t.plugins),o=Ft(t.settings),s=Nt(t.collectionTypes),i=Nt(t.singleTypes);return[...n,...o,...s,...i]},es=[{labelId:"app.components.LeftMenuLinkContainer.collectionTypes",defaultMessage:"Collection Types",id:"collectionTypes"},{labelId:"app.components.LeftMenuLinkContainer.singleTypes",id:"singleTypes",defaultMessage:"Single Types"},{labelId:"app.components.LeftMenuLinkContainer.plugins",defaultMessage:"Plugins",id:"plugins"},{labelId:"app.components.LeftMenuLinkContainer.settings",defaultMessage:"Settings",id:"settings"}],st=(0,e.forwardRef)(({layout:t,isFormDisabled:n,permissions:o},s)=>{const[{initialData:i,layouts:l,modifiedData:c},d]=(0,e.useReducer)(Xn,zn,()=>Kn(t,o)),{formatMessage:m}=(0,j.Z)();(0,e.useImperativeHandle)(s,()=>({getPermissions(){const O=(0,S.difference)(i.collectionTypes,c.collectionTypes),E=(0,S.difference)(i.singleTypes,c.singleTypes),g={...O,...E};let M;return F()(g)?M=!1:M=Object.values(g).some(T=>Object.values(T).some(L=>b()(L,"conditions"))),{permissionsToSend:_n(c),didUpdateConditions:M}},resetForm(){d({type:"RESET_FORM"})},setFormAfterSubmit(){d({type:"SET_FORM_AFTER_SUBMIT"})}}));const u=(O,E,g,M)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX",pathToCollectionType:O,propertyName:E,rowName:g,value:M})},p=(O,E,g)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX",collectionTypeKind:O,actionId:E,value:g})},h=O=>{d({type:"ON_CHANGE_CONDITIONS",conditions:O})},A=(0,e.useCallback)(({target:{name:O,value:E}})=>{d({type:"ON_CHANGE_SIMPLE_CHECKBOX",keys:O,value:E})},[]),B=(0,e.useCallback)(({target:{name:O,value:E}})=>{d({type:"ON_CHANGE_TOGGLE_PARENT_CHECKBOX",keys:O,value:E})},[]);return e.createElement(Tn,{value:{availableConditions:t.conditions,modifiedData:c,onChangeConditions:h,onChangeSimpleCheckbox:A,onChangeParentCheckbox:B,onChangeCollectionTypeLeftActionRowCheckbox:u,onChangeCollectionTypeGlobalActionCheckbox:p}},e.createElement(v.v,{id:"tabs",label:m({id:"Settings.permissions.users.tabs.label",defaultMessage:"Tabs Permissions"})},e.createElement($.m,null,es.map(O=>e.createElement($.O,{key:O.id},m({id:O.labelId,defaultMessage:O.defaultMessage})))),e.createElement(f.n,{style:{position:"relative"}},e.createElement(f.x,null,e.createElement(bt,{layout:l.collectionTypes,kind:"collectionTypes",isFormDisabled:n})),e.createElement(f.x,null,e.createElement(bt,{layout:l.singleTypes,kind:"singleTypes",isFormDisabled:n})),e.createElement(f.x,null,e.createElement(St,{layout:l.plugins,kind:"plugins",isFormDisabled:n})),e.createElement(f.x,null,e.createElement(St,{layout:l.settings,kind:"settings",isFormDisabled:n})))))});st.defaultProps={permissions:[],layout:{conditions:[],sections:{collectionTypes:{},singleTypes:{actions:[]},settings:[],plugins:[]}}},st.propTypes={layout:a().object,isFormDisabled:a().bool.isRequired,permissions:a().array};const ts=(0,e.memo)(st)},63727:(W,I,r)=>{"use strict";r.r(I),r.d(I,{default:()=>z});var e=r(27279),v=r(61166),$=r(49402),f=r(51447),S=r(36364),R=r(796),b=r(34041),D=r(85898),F=r(51413),V=r(49969),a=r(52185),j=r(98447),y=r(71563),te=r(26781),de=r(4644),C=r(51754),x=r(90065),U=r(442),ge=r(35557),$e=r(90529),Ee=r(49899),P=r(19098),Le=r(87549),Te=r(70627),Y=r.n(Te);const ue=({disabled:ne,role:X,values:k,errors:J,onChange:le,onBlur:re})=>{const{formatMessage:G}=(0,te.Z)();return e.createElement(a.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(D.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(D.k,{justifyContent:"space-between"},e.createElement(a.x,null,e.createElement(a.x,null,e.createElement(ge.Z,{fontWeight:"bold"},X?X.name:G({id:"global.details",defaultMessage:"Details"}))),e.createElement(a.x,null,e.createElement(ge.Z,{textColor:"neutral500",variant:"pi"},X?X.description:G({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(F.z,{disabled:!0,variant:"secondary"},G({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:X.usersCount}))),e.createElement($e.r,{gap:4},e.createElement(Ee.P,{col:6},e.createElement(P.o,{disabled:ne,name:"name",error:J.name&&G({id:J.name}),label:G({id:"global.name",defaultMessage:"Name"}),onChange:le,onBlur:re,required:!0,value:k.name||""})),e.createElement(Ee.P,{col:6},e.createElement(Le.g,{disabled:ne,label:G({id:"global.description",defaultMessage:"Description"}),id:"description",error:J.name&&G({id:J.name}),onChange:le,onBlur:re},k.description||"")))))};ue.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},ue.propTypes={disabled:Y().bool,errors:Y().object.isRequired,onBlur:Y().func.isRequired,onChange:Y().func.isRequired,role:Y().object,values:Y().object};const ve=ue;var De=r(47853);const fe=De.Ry().shape({name:De.Z_().required(v.translatedErrors.required)}),je=()=>{const ne=(0,v.useNotification)(),{formatMessage:X}=(0,te.Z)(),{params:{id:k}}=(0,f.$B)("/settings/roles/:id"),{put:J}=(0,v.useFetchClient)(),[le,re]=(0,e.useState)(!1),G=(0,e.useRef)(),{lockApp:se,unlockApp:Ie}=(0,v.useOverlayBlocker)(),{trackUsage:Fe}=(0,v.useTracking)(),{formatAPIError:me}=(0,v.useAPIErrorHandler)(),{isLoading:Be,data:Pe}=(0,x.d)(k,{cacheTime:0}),{roles:[ce={}],isLoading:be,refetch:Ne}=(0,C.F)({id:k},{cacheTime:0}),{permissions:Ge,isLoading:he}=(0,de.V)({id:k},{cacheTime:0}),w=async ee=>{try{se(),re(!0);const{permissionsToSend:oe,didUpdateConditions:ye}=G.current.getPermissions();await J(`/admin/roles/${k}`,ee),ce.code!=="strapi-super-admin"&&(await J(`/admin/roles/${k}/permissions`,{permissions:oe}),ye&&Fe("didUpdateConditions")),G.current.setFormAfterSubmit(),await Ne(),ne({type:"success",message:{id:"notification.success.saved"}})}catch(oe){ne({type:"warning",message:me(oe)})}finally{re(!1),Ie()}},_=!be&&ce.code==="strapi-super-admin";return e.createElement(R.o,null,e.createElement(v.SettingsPageTitle,{name:"Roles"}),e.createElement(y.J9,{enableReinitialize:!0,initialValues:{name:ce.name,description:ce.description},onSubmit:w,validationSchema:fe,validateOnChange:!1},({handleSubmit:ee,values:oe,errors:ye,handleChange:ot,handleBlur:Ze})=>e.createElement("form",{onSubmit:ee},e.createElement(b.T,{primaryAction:e.createElement(D.k,{gap:2},e.createElement(F.z,{disabled:ce.code==="strapi-super-admin",onClick:ee,loading:le,size:"L"},X({id:"global.save",defaultMessage:"Save"}))),title:X({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:X({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(v.Link,{startIcon:e.createElement(j.Z,null),to:"/settings/roles"},X({id:"global.back",defaultMessage:"Back"}))}),e.createElement(V.D,null,e.createElement(D.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(ve,{isLoading:be||he,disabled:_,errors:ye,values:oe,onChange:ot,onBlur:Ze,role:ce}),!Be&&!be&&!he?e.createElement(a.x,{shadow:"filterShadow",hasRadius:!0},e.createElement(U.Z,{isFormDisabled:_,permissions:Ge,ref:G,layout:Pe})):e.createElement(a.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(v.LoadingIndicatorPage,null)))))))},z=()=>{const ne=(0,$.v9)(S._),{isLoading:X,allowedActions:{canRead:k,canUpdate:J}}=(0,v.useRBAC)({read:ne.settings.roles.read,update:ne.settings.roles.update});return X?e.createElement(v.LoadingIndicatorPage,null):!k&&!J?e.createElement(f.l_,{to:"/"}):e.createElement(je,null)}},90065:(W,I,r)=>{"use strict";r.d(I,{d:()=>$});var e=r(61166),v=r(40464);const $=(f,S={})=>{const{get:R}=(0,e.useFetchClient)(),{data:b,error:D,isError:F,isLoading:V}=(0,v.useQuery)(["permissions",f],async()=>{const{data:{data:a}}=await R("/admin/permissions",{params:{role:f}});return a},S);return{data:b,error:D,isError:F,isLoading:V}}},29520:W=>{function I(r,e,v,$){for(var f=-1,S=r==null?0:r.length;++f<S;){var R=r[f];e($,R,v(R),r)}return $}W.exports=I},98694:(W,I,r)=>{var e=r(1107);function v($,f,S,R){return e($,function(b,D,F){f(R,b,S(b),F)}),R}W.exports=v},37177:(W,I,r)=>{var e=r(29520),v=r(98694),$=r(90040),f=r(26126);function S(R,b){return function(D,F){var V=f(D)?e:v,a=b?b():{};return V(D,R,$(F,2),a)}}W.exports=S},39738:(W,I,r)=>{var e=r(93367),v=1/0;function $(f){var S=f==null?0:f.length;return S?e(f,v):[]}W.exports=$},63799:(W,I,r)=>{var e=r(71041),v=r(37177),$=Object.prototype,f=$.hasOwnProperty,S=v(function(R,b,D){f.call(R,D)?R[D].push(b):e(R,D,[b])});W.exports=S},89486:(W,I,r)=>{"use strict";r.d(I,{O:()=>F});var e=r(74081),v=r(27279),$=r(72450),f=r(93415),S=r(32370);const R=()=>(0,e.jsx)(f.x,{"aria-hidden":!0,paddingLeft:1,paddingRight:1,children:(0,e.jsx)(S.Z,{variant:"pi",textColor:"neutral500",children:"/"})});R.displayName="Divider";var b=r(10701);const D=(0,$.default)(b.k)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:V})=>`calc(-1*${V.spaces[2]})`};
  }
`,F=({label:V,children:a,...j})=>{const y=v.Children.toArray(a);return(0,e.jsx)(f.x,{"aria-label":V,...j,children:(0,e.jsx)(D,{as:"ol",children:v.Children.map(y,(te,de)=>{const C=y.length>1&&de+1<y.length;return(0,e.jsxs)(b.k,{inline:!0,as:"li",children:[te,C&&(0,e.jsx)(R,{})]})})})})};F.displayName="Breadcrumbs"},82298:(W,I,r)=>{"use strict";r.d(I,{$:()=>f});var e=r(74081),v=r(93415),$=r(32370);const f=({children:S,isCurrent:R=!1,...b})=>(0,e.jsx)(v.x,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1,children:(0,e.jsx)($.Z,{variant:"pi",textColor:"neutral800",fontWeight:R?"bold":"normal","aria-current":R,...b,children:S})});f.displayName="Crumb"}}]);
