"use strict";(self.webpackChunkserver_provitask=self.webpackChunkserver_provitask||[]).push([[3455],{51754:(Y,O,t)=>{t.d(O,{F:()=>x});var e=t(61166),a=t(26781),A=t(40464);const x=(Z={},F={})=>{const{id:D="",...B}=Z,{get:U}=(0,e.useFetchClient)(),{locale:V}=(0,a.Z)(),$=(0,e.useCollator)(V,{sensitivity:"base"}),{data:h,error:I,isError:r,isLoading:g,refetch:H}=(0,A.useQuery)(["roles",D,B],async()=>{const{data:y}=await U(`/admin/roles/${D??""}`,{params:B});return y},F);let L=[];return D&&h?L=[h.data]:Array.isArray(h?.data)&&(L=h.data),{roles:L.sort((y,K)=>$.compare(y.name,K.name)),error:I,isError:r,isLoading:g,refetch:H}}},7513:(Y,O,t)=>{t.r(O),t.d(O,{default:()=>ue});var e=t(27279),a=t(61166),A=t(49402),x=t(36364),Z=t(796),F=t(34041),D=t(51413),B=t(51452),U=t(49969),V=t(92712),$=t(89630),h=t(7609),I=t(66016),r=t(9465),g=t(35557),H=t(17992),L=t(84428),y=t(20049),K=t(9663),w=t(18076),J=t(25659),Q=t(26781),q=t(51447),_=t(51754);const ee=()=>"todo empty role";var te=t(85898),le=t(52185),ne=t(2667),ae=t(70627),f=t.n(ae);const j=({id:n,name:i,description:s,usersCount:C,icons:o,rowIndex:M,canUpdate:c})=>{const{formatMessage:R}=(0,Q.Z)(),[,T]=o,d=R({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {#  user} one {#  user} other {# users}}"},{number:C});return e.createElement(I.Tr,{"aria-rowindex":M,key:n,...c?(0,a.onRowClick)({fn:T.onClick}):{}},e.createElement(r.Td,{maxWidth:(0,a.pxToRem)(130)},e.createElement(g.Z,{ellipsis:!0,textColor:"neutral800"},i)),e.createElement(r.Td,{maxWidth:(0,a.pxToRem)(250)},e.createElement(g.Z,{ellipsis:!0,textColor:"neutral800"},s)),e.createElement(r.Td,null,e.createElement(g.Z,{textColor:"neutral800"},d)),e.createElement(r.Td,null,e.createElement(te.k,{justifyContent:"flex-end",...a.stopPropagation},o.map((u,p)=>u?e.createElement(le.x,{key:u.label,paddingLeft:p===0?0:1},e.createElement(ne.h,{onClick:u.onClick,label:u.label,noBorder:!0,icon:u.icon})):null))))};j.propTypes={id:f().number.isRequired,name:f().string.isRequired,description:f().string.isRequired,usersCount:f().number.isRequired,icons:f().array.isRequired,rowIndex:f().number.isRequired,canUpdate:f().bool},j.defaultProps={canUpdate:!1};const se=j;var oe=t(61815);const re={roleToDelete:null,showModalConfirmButtonLoading:!1,shouldRefetchData:!1},ie=(n,i)=>(0,oe.ZP)(n,s=>{switch(i.type){case"ON_REMOVE_ROLES":{s.showModalConfirmButtonLoading=!0;break}case"ON_REMOVE_ROLES_SUCCEEDED":{s.shouldRefetchData=!0,s.roleToDelete=null;break}case"RESET_DATA_TO_DELETE":{s.shouldRefetchData=!1,s.roleToDelete=null,s.showModalConfirmButtonLoading=!1;break}case"SET_ROLE_TO_DELETE":{s.roleToDelete=i.id;break}default:return s}}),ce=({canCreate:n,canDelete:i,canUpdate:s,refetchRoles:C})=>{const{formatMessage:o}=(0,Q.Z)(),{formatAPIError:M}=(0,a.useAPIErrorHandler)(),c=(0,a.useNotification)(),[R,T]=(0,e.useState)(!1),{push:d}=(0,q.k6)(),[{selectedRoles:u,showModalConfirmButtonLoading:p,roleToDelete:k},P]=(0,e.useReducer)(ie,re),{post:z}=(0,a.getFetchClient)(),G=async()=>{try{P({type:"ON_REMOVE_ROLES"}),await z("/admin/roles/batch-delete",{ids:[k]}),await C(),P({type:"RESET_DATA_TO_DELETE"})}catch(l){c({type:"warning",message:M(l)})}v()},S=(0,e.useCallback)(l=>{d(`/settings/roles/duplicate/${l}`)},[d]),N=()=>d("/settings/roles/new"),W=(0,e.useCallback)(l=>{P({type:"SET_ROLE_TO_DELETE",id:l}),v()},[]),v=()=>T(l=>!l),m=(0,e.useCallback)(l=>{d(`/settings/roles/${l}`)},[d]),b=(0,e.useCallback)((l,E)=>{l.preventDefault(),l.stopPropagation(),E.usersCount?c({type:"info",message:{id:"Roles.ListPage.notification.delete-not-allowed"}}):W(E.id)},[c,W]),X=(0,e.useCallback)((l,E)=>{l.preventDefault(),l.stopPropagation(),S(E.id)},[S]),me=(0,e.useCallback)(l=>[...n?[{onClick:E=>X(E,l),label:o({id:"app.utils.duplicate",defaultMessage:"Duplicate"}),icon:e.createElement(y.Z,null)}]:[],...s?[{onClick:()=>m(l.id),label:o({id:"app.utils.edit",defaultMessage:"Edit"}),icon:e.createElement(K.Z,null)}]:[],...i?[{onClick:E=>b(E,l),label:o({id:"global.delete",defaultMessage:"Delete"}),icon:e.createElement(w.Z,null)}]:[]],[o,b,X,m,n,s,i]);return{handleNewRoleClick:N,getIcons:me,selectedRoles:u,isWarningDeleteAllOpened:R,showModalConfirmButtonLoading:p,handleToggleModal:v,handleDeleteData:G}},de=()=>{const{formatMessage:n}=(0,Q.Z)();(0,a.useFocusWhenNavigate)();const i=(0,A.v9)(x._),[{query:s}]=(0,a.useQueryParams)(),{isLoading:C,allowedActions:{canCreate:o,canDelete:M,canRead:c,canUpdate:R}}=(0,a.useRBAC)(i.settings.roles),{roles:T,isLoading:d,refetch:u}=(0,_.F)({filters:s?._q?{name:{$containsi:s._q}}:void 0},{cacheTime:0,enabled:!C&&c}),{handleNewRoleClick:p,getIcons:k,isWarningDeleteAllOpened:P,showModalConfirmButtonLoading:z,handleToggleModal:G,handleDeleteData:S}=ce({refetchRoles:u,canCreate:o,canDelete:M,canUpdate:R}),N=T.length+1,W=6;if(C)return e.createElement(Z.o,null,e.createElement(a.LoadingIndicatorPage,null));const v=n({id:"global.roles",defaultMessage:"roles"});return e.createElement(Z.o,null,e.createElement(a.SettingsPageTitle,{name:"Roles"}),e.createElement(F.T,{primaryAction:o?e.createElement(D.z,{onClick:p,startIcon:e.createElement(J.Z,null),size:"S"},n({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})):null,title:v,subtitle:n({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),as:"h2"}),c&&e.createElement(B.Z,{startActions:e.createElement(a.SearchURLQuery,{label:n({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:v})})}),c&&e.createElement(U.D,null,e.createElement(V.i,{colCount:W,rowCount:N,footer:o?e.createElement($.c,{onClick:p,icon:e.createElement(J.Z,null)},n({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})):null},e.createElement(h.h,null,e.createElement(I.Tr,{"aria-rowindex":1},e.createElement(r.Th,null,e.createElement(g.Z,{variant:"sigma",textColor:"neutral600"},n({id:"global.name",defaultMessage:"Name"}))),e.createElement(r.Th,null,e.createElement(g.Z,{variant:"sigma",textColor:"neutral600"},n({id:"global.description",defaultMessage:"Description"}))),e.createElement(r.Th,null,e.createElement(g.Z,{variant:"sigma",textColor:"neutral600"},n({id:"global.users",defaultMessage:"Users"}))),e.createElement(r.Th,null,e.createElement(H.T,null,n({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(L.p,null,T?.map((m,b)=>e.createElement(se,{key:m.id,id:m.id,name:m.name,description:m.description,usersCount:m.usersCount,icons:k(m),rowIndex:b+2,canUpdate:R})))),!N&&!d&&e.createElement(ee,null)),e.createElement(a.ConfirmDialog,{isOpen:P,onConfirm:S,isConfirmButtonLoading:z,onToggleDialog:G}))},ue=()=>{const n=(0,A.v9)(x._);return e.createElement(a.CheckPagePermissions,{permissions:n.settings.roles.main},e.createElement(de,null))}}}]);
