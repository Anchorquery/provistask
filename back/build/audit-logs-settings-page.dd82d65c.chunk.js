"use strict";(self.webpackChunkserver_provitask=self.webpackChunkserver_provitask||[]).push([[2812],{54920:(U,h,t)=>{t.d(h,{R:()=>v});var e=t(61166),n=t(40464);function v(p={},T={}){const{id:g="",...d}=p,{get:A}=(0,e.useFetchClient)(),{data:f,isError:C,isLoading:E,refetch:D}=(0,n.useQuery)(["users",g,d],async()=>{const{data:{data:R}}=await A(`/admin/users/${g}`,{params:d});return R},T);let L=[];return g&&f?L=[f]:Array.isArray(f?.results)&&(L=f.results),{users:L,pagination:f?.pagination??null,isLoading:E,isError:C,refetch:D}}},71359:(U,h,t)=>{t.d(h,{Z:()=>C});var e=t(27279),n=t(52185),v=t(51413),p=t(61166),T=t(22905),g=t(70627),d=t.n(g),A=t(26781);const f=({displayedFilters:E})=>{const[D,L]=(0,e.useState)(!1),{formatMessage:R}=(0,A.Z)(),S=(0,e.useRef)(),b=()=>{L(N=>!N)};return e.createElement(e.Fragment,null,e.createElement(n.x,{paddingTop:1,paddingBottom:1},e.createElement(v.z,{variant:"tertiary",ref:S,startIcon:e.createElement(T.Z,null),onClick:b,size:"S"},R({id:"app.utils.filters",defaultMessage:"Filters"})),D&&e.createElement(p.FilterPopoverURLQuery,{displayedFilters:E,isVisible:D,onToggle:b,source:S})),e.createElement(p.FilterListURLQuery,{filtersSchema:E}))};f.propTypes={displayedFilters:d().arrayOf(d().shape({name:d().string.isRequired,metadatas:d().shape({label:d().string}),fieldSchema:d().shape({type:d().string})})).isRequired};const C=f},67220:(U,h,t)=>{t.r(h),t.d(h,{default:()=>he});var e=t(27279),n=t(61166),v=t(49402),p=t(36364),T=t(1296),g=t(49969),d=t(52185),A=t(796),f=t(34041),C=t(51452),E=t(26781),D=t(71359),L=t(40464),R=t(51447),S=t(54920);const N=({canReadAuditLogs:a,canReadUsers:m})=>{const{get:c}=(0,n.useFetchClient)(),{search:i}=(0,R.TH)(),u=(0,n.useNotification)(),[{query:l}]=(0,n.useQueryParams)(),s={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:M=>u({type:"warning",message:M.message})},{users:r,isError:y,isLoading:P}=(0,S.R)({},{...s,enabled:m,staleTime:2*(1e3*60)}),{data:O,isLoading:I,isError:j}=(0,L.useQuery)(["auditLogs",i],async()=>{const{data:M}=await c("/admin/audit-logs",{params:l});return M},{...s,enabled:a});return{auditLogs:O,users:r,isLoading:P||I,hasError:j||y}};var w=t(81565),k=t(37386),q=t(23851),_=t(89486),ee=t(82298),te=t(70627),o=t.n(te),ae=t(33866);const Q=()=>{const{formatDate:a}=(0,E.Z)();return c=>{const i=(0,ae.Z)(c),u=a(i,{dateStyle:"long"}),l=a(i,{timeStyle:"medium",hourCycle:"h24"});return`${u}, ${l}`}};var x=t(85898),se=t(62475),B=t(35557),ne=t(90529),oe=t(93960);const z={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},Z=a=>z[a]||a,H=({actionLabel:a,actionName:m})=>e.createElement(x.k,{direction:"column",alignItems:"baseline",gap:1},e.createElement(B.Z,{textColor:"neutral600",variant:"sigma"},a),e.createElement(B.Z,{textColor:"neutral600"},m));H.propTypes={actionLabel:o().string.isRequired,actionName:o().string.isRequired};const F=H,$=({status:a,data:m,formattedDate:c})=>{const{formatMessage:i}=(0,E.Z)();if(a==="loading")return e.createElement(x.k,{padding:7,justifyContent:"center",alignItems:"center"},e.createElement(se.a,null,"Loading content..."));const{action:u,user:l,payload:s}=m;return e.createElement(e.Fragment,null,e.createElement(d.x,{marginBottom:3},e.createElement(B.Z,{variant:"delta",id:"title"},i({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"}))),e.createElement(ne.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0},e.createElement(F,{actionLabel:i({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:i({id:`Settings.permissions.auditLogs.${u}`,defaultMessage:Z(u)},{model:s?.model})}),e.createElement(F,{actionLabel:i({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:c}),e.createElement(F,{actionLabel:i({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:l?.displayName||"-"}),e.createElement(F,{actionLabel:i({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:l?.id.toString()||"-"})),e.createElement(oe.V,{value:JSON.stringify(s,null,2),disabled:!0,label:i({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})}))};$.defaultProps={data:{}},$.propTypes={status:o().oneOf(["idle","loading","error","success"]).isRequired,data:o().shape({action:o().string,date:o().string,payload:o().object,user:o().object}),formattedDate:o().string.isRequired};const ie=$,J=({handleClose:a,logId:m})=>{const{get:c}=(0,n.useFetchClient)(),i=(0,n.useNotification)(),u=async P=>{const{data:O}=await c(`/admin/audit-logs/${P}`);if(!O)throw new Error("Audit log not found");return O},{data:l,status:s}=(0,L.useQuery)(["audit-log",m],()=>u(m),{onError(){i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),a()}}),r=Q(),y=l?r(l.date):"";return e.createElement(w.P,{onClose:a,labelledBy:"title"},e.createElement(k.x,null,e.createElement(_.O,{label:y,id:"title"},e.createElement(ee.$,{isCurrent:!0},y))),e.createElement(q.f,null,e.createElement(ie,{status:s,data:l,formattedDate:y})))};J.propTypes={handleClose:o().func.isRequired,logId:o().string.isRequired};const re=J,W=({pagination:a})=>e.createElement(d.x,{paddingTop:4},e.createElement(x.k,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(n.PageSizeURLQuery,null),e.createElement(n.PaginationURLQuery,{pagination:a})));W.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},W.propTypes={pagination:o().shape({page:o().number,pageCount:o().number,pageSize:o().number,total:o().number})};const le=W;var de=t(84428),me=t(66016),Y=t(9465),ue=t(2667),ce=t(84207);const V=({headers:a,rows:m,onOpenModal:c})=>{const{formatMessage:i}=(0,E.Z)(),u=Q(),l=({type:s,value:r,model:y})=>s==="date"?u(r):s==="action"?i({id:`Settings.permissions.auditLogs.${r}`,defaultMessage:Z(r)},{model:y}):r||"-";return e.createElement(de.p,null,m.map(s=>e.createElement(me.Tr,{key:s.id,...(0,n.onRowClick)({fn:()=>c(s.id)})},a.map(({key:r,name:y,cellFormatter:P})=>e.createElement(Y.Td,{key:r},e.createElement(B.Z,{textColor:"neutral800"},l({type:r,value:P?P(s[y]):s[y],model:s.payload?.model})))),e.createElement(Y.Td,{...n.stopPropagation},e.createElement(x.k,{justifyContent:"end"},e.createElement(ue.h,{onClick:()=>c(s.id),"aria-label":i({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${s.action} action`}),noBorder:!0,icon:e.createElement(ce.Z,null)}))))))};V.defaultProps={rows:[]},V.propTypes={headers:o().array.isRequired,rows:o().array,onOpenModal:o().func.isRequired};const ge=V;var pe=t(71943),fe=t(930);const K=({value:a,options:m,onChange:c})=>{const{formatMessage:i}=(0,E.Z)(),u=i({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return e.createElement(pe.hQ,{"aria-label":u,value:a,onChange:c},m.map(({label:l,customValue:s})=>e.createElement(fe.O,{key:s,value:s},l)))};K.defaultProps={value:null},K.propTypes={value:o().string,options:o().arrayOf(o().shape({label:o().string.isRequired,customValue:o().string.isRequired}).isRequired).isRequired,onChange:o().func.isRequired};const G=K,X=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],ye=({formatMessage:a,users:m,canReadUsers:c})=>{const i=Object.keys(z).map(l=>({label:a({id:`Settings.permissions.auditLogs.${l}`,defaultMessage:Z(l)},{model:void 0}),customValue:l})),u=[{name:"action",metadatas:{customOperators:X,label:a({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),options:i,customInput:G},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:a({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(c&&m){const l=r=>r.username?r.username:r.firstname&&r.lastname?a({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:r.firstname,lastname:r.lastname}):r.email,s=m.map(r=>({label:l(r),customValue:r.id.toString()}));return[...u,{name:"user",metadatas:{customOperators:X,label:a({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:s,customInput:G},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return u},Ee=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:a=>a?a.displayName:""}],Le=()=>{const{formatMessage:a}=(0,E.Z)(),m=(0,v.v9)(p._),{allowedActions:{canRead:c,canReadUsers:i}}=(0,n.useRBAC)({...m.settings.auditLogs,readUsers:m.settings.users.read}),[{query:u},l]=(0,n.useQueryParams)(),{auditLogs:s,users:r,isLoading:y,hasError:P}=N({canReadAuditLogs:c,canReadUsers:i});(0,n.useFocusWhenNavigate)();const O=ye({formatMessage:a,users:r,canReadUsers:i}),I=a({id:"global.auditLogs",defaultMessage:"Audit Logs"}),j=Ee.map(M=>({...M,metadatas:{...M.metadatas,label:a(M.metadatas.label)}}));return P?e.createElement(T.A,null,e.createElement(g.D,null,e.createElement(d.x,{paddingTop:8},e.createElement(n.AnErrorOccurred,null)))):e.createElement(A.o,{"aria-busy":y},e.createElement(n.SettingsPageTitle,{name:I}),e.createElement(f.T,{title:I,subtitle:a({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),e.createElement(C.Z,{startActions:e.createElement(D.Z,{displayedFilters:O})}),e.createElement(g.D,{canRead:c},e.createElement(n.DynamicTable,{contentType:"Audit logs",headers:j,rows:s?.results||[],withBulkActions:!0,isLoading:y},e.createElement(ge,{headers:j,rows:s?.results||[],onOpenModal:M=>l({id:M})})),e.createElement(le,{pagination:s?.pagination})),u?.id&&e.createElement(re,{handleClose:()=>l({id:null},"remove"),logId:u.id}))},he=()=>{const a=(0,v.v9)(p._);return e.createElement(n.CheckPagePermissions,{permissions:a.settings.auditLogs.main},e.createElement(Le,null))}},89486:(U,h,t)=>{t.d(h,{O:()=>f});var e=t(74081),n=t(27279),v=t(72450),p=t(93415),T=t(32370);const g=()=>(0,e.jsx)(p.x,{"aria-hidden":!0,paddingLeft:1,paddingRight:1,children:(0,e.jsx)(T.Z,{variant:"pi",textColor:"neutral500",children:"/"})});g.displayName="Divider";var d=t(10701);const A=(0,v.default)(d.k)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:C})=>`calc(-1*${C.spaces[2]})`};
  }
`,f=({label:C,children:E,...D})=>{const L=n.Children.toArray(E);return(0,e.jsx)(p.x,{"aria-label":C,...D,children:(0,e.jsx)(A,{as:"ol",children:n.Children.map(L,(R,S)=>{const b=L.length>1&&S+1<L.length;return(0,e.jsxs)(d.k,{inline:!0,as:"li",children:[R,b&&(0,e.jsx)(g,{})]})})})})};f.displayName="Breadcrumbs"},82298:(U,h,t)=>{t.d(h,{$:()=>p});var e=t(74081),n=t(93415),v=t(32370);const p=({children:T,isCurrent:g=!1,...d})=>(0,e.jsx)(n.x,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1,children:(0,e.jsx)(v.Z,{variant:"pi",textColor:"neutral800",fontWeight:g?"bold":"normal","aria-current":g,...d,children:T})});p.displayName="Crumb"}}]);
