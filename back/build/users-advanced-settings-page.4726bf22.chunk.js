"use strict";(self.webpackChunkserver_provitask=self.webpackChunkserver_provitask||[]).push([[9460],{58350:(C,u,e)=>{e.r(u),e.d(u,{default:()=>w});var t=e(27279),g=e(86042),y=e(796),f=e(34041),p=e(49969),v=e(51413),r=e(52185),h=e(85898),d=e(35557),E=e(90529),l=e(49899),c=e(52870),R=e(33699),n=e(61166),N=e(82943),z=e(71563),I=e(26781),S=e(40464),F=e(84419),a=e(99688);const Z=[{intlLabel:{id:(0,a.OB)("EditForm.inputToggle.label.email"),defaultMessage:"One account per email address"},description:{id:(0,a.OB)("EditForm.inputToggle.description.email"),defaultMessage:"Disallow the user to create multiple accounts using the same email address with different authentication providers."},name:"unique_email",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,a.OB)("EditForm.inputToggle.label.sign-up"),defaultMessage:"Enable sign-ups"},description:{id:(0,a.OB)("EditForm.inputToggle.description.sign-up"),defaultMessage:"When disabled (OFF), the registration process is forbidden. No one can subscribe anymore no matter the used provider."},name:"allow_register",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,a.OB)("EditForm.inputToggle.label.email-reset-password"),defaultMessage:"Reset password page"},description:{id:(0,a.OB)("EditForm.inputToggle.description.email-reset-password"),defaultMessage:"URL of your application's reset password page."},placeholder:{id:(0,a.OB)("EditForm.inputToggle.placeholder.email-reset-password"),defaultMessage:"ex: https://youtfrontend.com/reset-password"},name:"email_reset_password",type:"text",size:{col:6,xs:12}},{intlLabel:{id:(0,a.OB)("EditForm.inputToggle.label.email-confirmation"),defaultMessage:"Enable email confirmation"},description:{id:(0,a.OB)("EditForm.inputToggle.description.email-confirmation"),defaultMessage:"When enabled (ON), new registered users receive a confirmation email."},name:"email_confirmation",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,a.OB)("EditForm.inputToggle.label.email-confirmation-redirection"),defaultMessage:"Redirection url"},description:{id:(0,a.OB)("EditForm.inputToggle.description.email-confirmation-redirection"),defaultMessage:"After you confirmed your email, choose where you will be redirected."},placeholder:{id:(0,a.OB)("EditForm.inputToggle.placeholder.email-confirmation-redirection"),defaultMessage:"ex: https://youtfrontend.com/email-confirmation"},name:"email_confirmation_redirection",type:"text",size:{col:6,xs:12}}];var m=e(47853);const A=new RegExp("(^$)|((.+:\\/\\/.*)(d*)\\/?(.*))"),H=m.Ry().shape({email_confirmation_redirection:m.nK().when("email_confirmation",{is:!0,then:m.Z_().matches(A).required(),otherwise:m.Z_().nullable()}),email_reset_password:m.Z_(n.translatedErrors.string).matches(A,n.translatedErrors.regex).nullable()}),D=()=>t.createElement(n.CheckPagePermissions,{permissions:F._.readAdvancedSettings},t.createElement(G,null)),G=()=>{const{formatMessage:o}=(0,I.Z)(),O=(0,n.useNotification)(),{lockApp:W,unlockApp:T}=(0,n.useOverlayBlocker)(),{notifyStatus:Q}=(0,g.G)(),U=(0,S.useQueryClient)(),{get:j,put:X}=(0,n.useFetchClient)(),{formatAPIError:J}=(0,n.useAPIErrorHandler)();(0,n.useFocusWhenNavigate)();const{isLoading:K,allowedActions:{canUpdate:b}}=(0,n.useRBAC)({update:F._.updateAdvancedSettings}),{isLoading:V,data:P}=(0,S.useQuery)(["users-permissions","advanced"],async()=>{const{data:i}=await j("/users-permissions/advanced");return i},{onSuccess(){Q(o({id:(0,a.OB)("Form.advancedSettings.data.loaded"),defaultMessage:"Advanced settings data has been loaded"}))},onError(){O({type:"warning",message:{id:(0,a.OB)("notification.error"),defaultMessage:"An error occured"}})}}),Y=K||V,L=(0,S.useMutation)(i=>X("/users-permissions/advanced",i),{async onSuccess(){await U.invalidateQueries(["users-permissions","advanced"]),O({type:"success",message:{id:(0,a.OB)("notification.success.saved"),defaultMessage:"Saved"}}),T()},onError(i){O({type:"warning",message:J(i)}),T()},refetchActive:!0}),{isLoading:$}=L,k=async i=>{W(),L.mutate({...i,email_confirmation_redirection:i.email_confirmation?i.email_confirmation_redirection:""})};return Y?t.createElement(y.o,{"aria-busy":"true"},t.createElement(n.SettingsPageTitle,{name:o({id:(0,a.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),t.createElement(f.T,{title:o({id:(0,a.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),t.createElement(p.D,null,t.createElement(n.LoadingIndicatorPage,null))):t.createElement(y.o,{"aria-busy":$},t.createElement(n.SettingsPageTitle,{name:o({id:(0,a.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),t.createElement(z.J9,{onSubmit:k,initialValues:P.settings,validateOnChange:!1,validationSchema:H,enableReinitialize:!0},({errors:i,values:B,handleChange:x,isSubmitting:q,dirty:_})=>t.createElement(n.Form,null,t.createElement(f.T,{title:o({id:(0,a.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"}),primaryAction:t.createElement(v.z,{loading:q,type:"submit",disabled:b?!_:!b,startIcon:t.createElement(N.Z,null),size:"S"},o({id:"global.save",defaultMessage:"Save"}))}),t.createElement(p.D,null,t.createElement(r.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(h.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(d.Z,{variant:"delta",as:"h2"},o({id:"global.settings",defaultMessage:"Settings"})),t.createElement(E.r,{gap:6},t.createElement(l.P,{col:6,s:12},t.createElement(c.P,{label:o({id:(0,a.OB)("EditForm.inputSelect.label.role"),defaultMessage:"Default role for authenticated users"}),value:B.default_role,hint:o({id:(0,a.OB)("EditForm.inputSelect.description.role"),defaultMessage:"It will attach the new authenticated user to the selected role."}),onChange:s=>x({target:{name:"default_role",value:s}})},P.roles.map(s=>t.createElement(R.W,{key:s.type,value:s.type},s.name)))),Z.map(s=>{let M=B[s.name];return M||(M=s.type==="bool"?!1:""),t.createElement(l.P,{key:s.name,...s.size},t.createElement(n.GenericInput,{...s,value:M,error:i[s.name],disabled:s.name==="email_confirmation_redirection"&&B.email_confirmation===!1,onChange:x}))}))))))))},w=D},99688:(C,u,e)=>{e.d(u,{YX:()=>f,OB:()=>p.Z});var t=e(10124),g=e.n(t);const f=v=>Object.keys(v).reduce((r,h)=>{const d=v[h].controllers,E=Object.keys(d).reduce((l,c)=>(g()(d[c])||(l[c]=d[c]),l),{});return g()(E)||(r[h]={controllers:E}),r},{});var p=e(58655)}}]);
